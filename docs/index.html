<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<!-- 2023-06-01 Thu 13:51 -->
<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>WaveVib - An OCTAVE/MATLAB Toolbox for Wave-Based Modeling of Nonlinear Jointed Structures</title>
<meta name="author" content="Nidish Narayanaa Balaji" />
<meta name="generator" content="Org Mode" />
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/bigblow_theme/css/htmlize.css"/>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/bigblow_theme/css/bigblow.css"/>
<link rel="stylesheet" type="text/css" href="https://fniessen.github.io/org-html-themes/src/bigblow_theme/css/hideshow.css"/>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/bigblow_theme/js/jquery-1.11.0.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/bigblow_theme/js/jquery-ui-1.10.2.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/bigblow_theme/js/jquery.localscroll-min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/bigblow_theme/js/jquery.scrollTo-1.4.3.1-min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/bigblow_theme/js/jquery.zclip.min.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/bigblow_theme/js/bigblow.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/bigblow_theme/js/hideshow.js"></script>
<script type="text/javascript" src="https://fniessen.github.io/org-html-themes/src/lib/js/jquery.stickytableheaders.min.js"></script>
<style> #content{max-width:1000px;}</style>

        <style>
        /* From: https://endlessparentheses.com/public/css/endless.css */
        /* See also: https://meta.superuser.com/questions/4788/css-for-the-new-kbd-style */
        kbd
        {
          -moz-border-radius: 6px;
          -moz-box-shadow: 0 1px 0 rgba(0,0,0,0.2),0 0 0 2px #fff inset;
          -webkit-border-radius: 6px;
          -webkit-box-shadow: 0 1px 0 rgba(0,0,0,0.2),0 0 0 2px #fff inset;
          background-color: #f7f7f7;
          border: 1px solid #ccc;
          border-radius: 6px;
          box-shadow: 0 1px 0 rgba(0,0,0,0.2),0 0 0 2px #fff inset;
          color: #333;
          display: inline-block;
          font-family: 'Droid Sans Mono', monospace;
          font-size: 80%;
          font-weight: normal;
          line-height: inherit;
          margin: 0 .1em;
          padding: .08em .4em;
          text-shadow: 0 1px 0 #fff;
          word-spacing: -4px;
        
          box-shadow: 2px 2px 2px #222; /* MA: An extra I've added. */
        }
        </style>
        <link rel="stylesheet" type="text/css" href="https://alhassy.github.io/org-special-block-extras/tooltipster/dist/css/tooltipster.bundle.min.css"/>
        
        <link rel="stylesheet" type="text/css" href="https://alhassy.github.io/org-special-block-extras/tooltipster/dist/css/plugins/tooltipster/sideTip/themes/tooltipster-sideTip-punk.min.css" />
        
        <script type="text/javascript">
            if (typeof jQuery == 'undefined') {
                document.write(unescape('%3Cscript src="https://code.jquery.com/jquery-1.10.0.min.js"%3E%3C/script%3E'));
            }
        </script>
        
         <script type="text/javascript"            src="https://alhassy.github.io/org-special-block-extras/tooltipster/dist/js/tooltipster.bundle.min.js"></script>
        
          <script>
                 $(document).ready(function() {
                     $('.tooltip').tooltipster({
                         theme: 'tooltipster-punk',
                         contentAsHTML: true,
                         animation: 'grow',
                         delay: [100,500],
                         // trigger: 'click'
                         trigger: 'custom',
                         triggerOpen: {
                             mouseenter: true
                         },
                         triggerClose: {
                             originClick: true,
                             scroll: true
                         }
         });
                 });
             </script>
        
        <style>
           abbr {color: red;}
        
           .tooltip { border-bottom: 1px dotted #000;
                      color:red;
                      text-decoration: none;}
        </style>
<script>
  window.MathJax = {
    tex: {
      ams: {
        multlineWidth: '85%'
      },
      tags: 'ams',
      tagSide: 'right',
      tagIndent: '.8em'
    },
    chtml: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    svg: {
      scale: 1.0,
      displayAlign: 'center',
      displayIndent: '0em'
    },
    output: {
      font: 'mathjax-modern',
      displayOverflow: 'overflow'
    }
  };
</script>

<script
  id="MathJax-script"
  async
  src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js">
</script>
</head>
<body>
<div id="content" class="content">
<h1 class="title">WaveVib - An OCTAVE/MATLAB Toolbox for Wave-Based Modeling of Nonlinear Jointed Structures</h1>
<div id="table-of-contents" role="doc-toc">
<h2>Table of Contents</h2>
<div id="text-table-of-contents" role="doc-toc">
<ul>
<li><a href="#org2ca0aa0">1. Introduction</a>
<ul>
<li><a href="#org7e147ee">1.1. The different folders in the repository</a></li>
</ul>
</li>
<li><a href="#orgebd4dfc">2. Programming Interface</a>
<ul>
<li><a href="#org7e11642">2.1. Specification of a Library of Dispersion Relationships</a></li>
<li><a href="#org7831a1a">2.2. Specification of the Pieces of a Model</a></li>
<li><a href="#orge499aa9">2.3. Specification of Boundary Conditions</a></li>
<li><a href="#orgec1578e">2.4. Specification of Joints</a>
<ul>
<li><a href="#org14953a5">2.4.1. Fused Joints</a></li>
<li><a href="#orgb48c09a">2.4.2. Linear Joints</a></li>
<li><a href="#org8a4a284">2.4.3. Nonlinear Joints</a></li>
</ul>
</li>
<li><a href="#orgb488f82">2.5. Computation of Linear Analysis Quantities</a>
<ul>
<li><a href="#org4b1e7c5">2.5.1. Linear Jacobian and Force vector</a></li>
<li><a href="#orgef8c78c">2.5.2. Linear Modal Analysis</a></li>
</ul>
</li>
<li><a href="#orgbdb3538">2.6. Nonlinear Periodic Response Analysis</a></li>
<li><a href="#org691242c">2.7. Continuation of Nonlinear Periodic Responses</a>
<ul>
<li><a href="#org9f65219">2.7.1. Stability of Nonlinear Solutions</a></li>
</ul>
</li>
<li><a href="#org3d42c3a">2.8. Post-Processing</a></li>
<li><a href="#orga422968">2.9. Advanced Interfaces</a>
<ul>
<li><a href="#org4f816c8">2.9.1. Minimalized Representation</a></li>
<li><a href="#orgd4f6af0">2.9.2. Quasi-Periodic Response Analysis</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org9a10c84">3. Examples</a>
<ul>
<li><a href="#org022442d">3.1. Single Bar</a>
<ul>
<li><a href="#org9607658">3.1.1. Code Overview</a></li>
<li><a href="#org2e0773d">3.1.2. Results</a></li>
<li><a href="#org795b9eb">3.1.3. <span class="todo TODO">TODO</span> Show mode-shapes in results</a></li>
</ul>
</li>
<li><a href="#org2541a1a">3.2. Linear-Jointed Bars</a>
<ul>
<li><a href="#org916a08e">3.2.1. Code Overview</a></li>
<li><a href="#orge57ca44">3.2.2. Results</a></li>
<li><a href="#orgb57a02a">3.2.3. <span class="todo TODO">TODO</span> Include a nicely labeled diagram in the description.</a></li>
<li><a href="#org867bc49">3.2.4. <span class="todo TODO">TODO</span> Describe how to use WVEVALWCOFS for evaluating wave coefficients and plot deflection shape.</a></li>
</ul>
</li>
<li><a href="#org4a2f825">3.3. Nonlinear-Jointed Bars</a>
<ul>
<li><a href="#orgc940a33">3.3.1. Code Overview</a></li>
<li><a href="#orga938ceb">3.3.2. Results</a></li>
<li><a href="#org5281059">3.3.3. <span class="todo TODO">TODO</span> Include a nice schematic diagram</a></li>
<li><a href="#orgcaf0ba5">3.3.4. <span class="todo TODO">TODO</span> Describe how to use WVEVALWCOFS for evaluating wave coefficients and plot deflection shape.</a></li>
</ul>
</li>
<li><a href="#org860f8f0">3.4. Nonlinear-Jointed Euler-Bernoulli Beams</a>
<ul>
<li><a href="#org747e9ce">3.4.1. Code Overview</a></li>
<li><a href="#orgbb19821">3.4.2. Results</a></li>
<li><a href="#org7aded87">3.4.3. <span class="todo TODO">TODO</span> Include a nicely labeled schematic of the considered system</a></li>
<li><a href="#orgd91dc32">3.4.4. <span class="todo TODO">TODO</span> Describe how to use WVEVALWCOFS for evaluating wave coefficients and plot deflection shape.</a></li>
</ul>
</li>
<li><a href="#orgc603825">3.5. Impacting Cantilever Beams</a>
<ul>
<li><a href="#orga4f4fa9">3.5.1. Code Overview</a></li>
<li><a href="#orgb32f8c6">3.5.2. Results</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#org0a13756">4. Development Avenues</a>
<ul>
<li><a href="#org287b7a3">4.1. <span class="todo TODO">TODO</span> Desirable Features</a></li>
<li><a href="#orgeb580e5">4.2. <span class="todo TODO">TODO</span> Bugfixes</a></li>
</ul>
</li>
<li><a href="#org0f2ced9">5. References</a></li>
</ul>
</div>
</div>
<style> summary:hover {background:pink;} </style>

<!-- <script type="text/javascript" src="./collcont_clkbls.js"></script> -->
<script>var HS_STARTUP_FOLDED = true;</script>

<div id="outline-container-org2ca0aa0" class="outline-2">
<h2 id="org2ca0aa0"><span class="section-number-2">1.</span> Introduction</h2>
<div class="outline-text-2" id="text-1">
<p>
<a href="https://github.com/Nidish96/wavevib">WaveVib</a> is intended to be a set of OCTAVE/MATLAB routines that can be used to study wave-based linear and nonlinear structures. The main advantage with using this approach comes from the fact that the linear portions of the problem are represented without any approximation (unlike weighted residual or variational approaches). The interface supports both periodic as well as quasi-periodic steady state response regimes. Immediate use cases include jointed beams, trusses, frame structures, fluid-filled columns, rotordynamics, etc.
</p>

<p>
A good starting place for the new user to the Wave-Based Modeling (WBM) framework &amp;/or this package are the papers <a href="#citeproc_bib_item_1">[1]</a>, <a href="#citeproc_bib_item_2">[2]</a>, upon which most of the rudiments of this package are based. The code is hosted on github here: <a href="https://github.com/Nidish96/wavevib">https://github.com/Nidish96/wavevib</a>
</p>
</div>
<div id="outline-container-org7e147ee" class="outline-3">
<h3 id="org7e147ee"><span class="section-number-3">1.1.</span> The different folders in the repository</h3>
<div class="outline-text-3" id="text-1-1">
<ol class="org-ol">
<li><a href="https://github.com/Nidish96/wavevib/tree/master/ROUTINES/">ROUTINES</a>
Contains the core routines of the package.</li>
<li><a href="https://github.com/Nidish96/wavevib/tree/master/EXAMPLES/">EXAMPLES</a>
Contains examples with most of the core functionality</li>
<li><a href="https://github.com/Nidish96/wavevib/tree/master/REPS/">REPS</a>
Contains miscellaneous reports (under REPn folders)</li>
<li><a href="wavevib_docs.html">docs</a>
Contains this main documentation</li>
<li><a href="https://github.com/Nidish96/wavevib/tree/master/DEVEL_QPER/">DEVEL_QPER</a>
Contains development scripts used for development of the quasi-periodic response routines &amp; examples.</li>
<li><a href="https://github.com/Nidish96/wavevib/tree/master/DEVEL_PER/">DEVEL_PER</a> [Obsolete]
Contains development scripts used for development of the periodic response routines &amp; examples.</li>
</ol>
</div>
</div>
</div>
<div id="outline-container-orgebd4dfc" class="outline-2">
<h2 id="orgebd4dfc"><span class="section-number-2">2.</span> Programming Interface</h2>
<div class="outline-text-2" id="text-2">
<p>
The purpose of this section is to provide a description of the programming interface incorporated in the design of WaveVib. Fig. <a href="#org760225e">1</a> presents an overview of the software plan graphically.
</p>

<div id="org760225e" class="figure">
<p><img src="./FIGS/rep1_SWPlan.png" alt="rep1_SWPlan.png" width="800px" />
</p>
<p><span class="figure-number">Figure 1: </span>The WaveVib Software Plan</p>
</div>

<p>
WaveVib is meant to serve as a toolbox that provides a few generic core routines that help define geometries, materials, joints, excitation, as well as other point-features. These routines are therefore written agnostic of the exact types of problems being dealt with. The following subsections are ordered in such a manner so as to aid usage by being read in order.
</p>
</div>
<div id="outline-container-org7e11642" class="outline-3">
<h3 id="org7e11642"><span class="section-number-3">2.1.</span> Specification of a Library of Dispersion Relationships</h3>
<div class="outline-text-3" id="text-2-1">
<p>
<a id="org619a818"></a>
A linear component of a model is completely specified through its wave-dispersion relationship(s). The dispersion relationship describes the temporal behavior of spatial waves (as also the spatial behavior of temporal waves). A single component can have just one dispersion relationship (as in the case of a 1D bar), or it can have multiple dispersion relationships (Beams). Here are some examples of common dispersion relationships.
</p>
<details class="code-details"
                 style ="padding: 1em;
                          background-color: #c9c9c9;
                          /* background-color: pink; */
                          border-radius: 15px;
                          color: hsl(157 75%);
                          font-size: 0.9em;
                          box-shadow: 0.05em 0.1em 5px 0.01em  #00000057;">
                  <summary>
                    <strong>
                      <font face="Courier" size="3" color="black">
                         Dispersion of 1D Bars
                      </font>
                    </strong>
                  </summary>
<p>
The equations of motion for a 1D bar (excluding boundary conditions) is specified as
</p>
\begin{equation}
\label{org7aad7be}
\rho \frac{\partial^2 u}{\partial t^2} - E_y \frac{\partial^2 u}{\partial X^2} = 0 \qquad X\in (0, \ell).
\end{equation}
<p>
Using the standard ansatz \(u(X,t)=\frac{U}{2} e^{j(kX-\omega t)}+c.c.\), the continuum domain yields the dispersion relationship,
</p>
\begin{equation}
\label{orgca4b018}
k_{1,2}(\omega) = \pm \frac{\omega}{\sqrt{E_y/\rho}}.
\end{equation}
<p>
This represents two wave components \(k_1\) and \(k_2\), with \(k_2=-k_1\). While the first wave component describes a forward moving wave, the second one describes a backward moving wave. The solution is therefore written at some point \(X_A\) as,
</p>
\begin{equation}
\label{orge9b012d}
u(x,t) = \left(a^+ e^{jkx} + a^- e^{-jkx}\right) e^{-j\omega t} + c.c.,
\end{equation}
<p>
where \(x\) is \(X-X_A\), i.e., the position of some point \(X\) relative to \(X_A\). All wave descriptions are written in this form (relative coordinate \(x\) and absolute coordinate \(X\)). 
</p>


</details>
<details class="code-details"
                 style ="padding: 1em;
                          background-color: white;
                          /* background-color: pink; */
                          border-radius: 15px;
                          color: hsl(157 75%);
                          font-size: 0.9em;
                          box-shadow: 0.05em 0.1em 5px 0.01em  #00000057;">
                  <summary>
                    <strong>
                      <font face="Courier" size="3" color="black">
                         Dispersion of 1D Euler-Bernoulli Beams
                      </font>
                    </strong>
                  </summary>
<p>
The equations of motion for a 1D Euler-Bernoulli Beam (excluding boundary conditions) is specified as
</p>
\begin{equation}
\label{orge5d6974}
\rho A \frac{\partial^2 u}{\partial t^2} + E_y I_y \frac{\partial^4 u}{\partial x^4} = 0 \qquad x\in (0, \ell).
\end{equation}
<p>
Here, \(u(x,t)\) denotes the transverse displacement of the beam neutral axis at location \(x\) and time \(t\). Using the standard ansatz \(u(x,t)=\frac{U}{2} e^{j(kx-\omega t)}+c.c.\), the continuum domain yields the dispersion relationship,
</p>
\begin{align}
\label{org3cce5b3}
k_{1,2}(\omega) &= \pm {\left(\frac{\rho A}{E_y I_y}\right)}^{1/4} = \pm k,\,\text{and}\\
k_{3,4}(\omega) &= \pm j {\left(\frac{\rho A}{E_y I_y}\right)}^{1/4} = \pm j k.
\end{align}
<p>
Unlike the case of the 1D Bar (eq. \eqref{org7aad7be}), the EB-Beam is described by four wave components out of which only two are real and the other two are imaginary. The fully real coefficients \(k_{1,2}\) are interpreted as forward and backward traveling waves, just as in the case of the 1D Bar, but \(k_{3,4}\) are non-traveling wave components and are referred to as <span class="underline"><b>evanescent waves</b></span> in the literature (see~<a href="#citeproc_bib_item_3">[3]</a>, for instance). With the former denoted by \(a^\pm\) and the latter by \(b^\pm\), the wave based solution is expressed (using relative coordinates \(x\)) as
</p>
\begin{equation}
\label{orgcb4a107}
u(x,t) = \left(a^+ e^{jkx} + a^- e^{-jkx} + b^+ e^{kx} + b^- e^{-kx} \right) e^{-i\omega t} + c.c..
\end{equation}
<p>
Note that the \(\pm\) superscripts are used for the evanescent wave components also (\(b^\pm\)) just by convention and this does not indicate that they are propagating. 
</p>


</details>
<p>
Through the examples,it is clear that a generic representation of the wave-based solution can be written as,
</p>
\begin{equation}
\label{org63301b4}
u(x,t) = \left(\sum_{n=1}^{N} a_n e^{j k_n x}\right) e^{-i\omega t} + c.c. = \left(a_1 e^{jk_1x} + a_2 e^{jk_2x} + \dots \right) e^{-i\omega t} + c.c.,
\end{equation}
<p>
where the model has \(N\) wave components, each with a wavenumber \(k_n\) and associated dispersion relationship \(k_n(\omega)\). This is the format that <code>wavevib</code> expects the user to specify the different dispersion relationships by. 
</p>

<p>
The following is a code snippet that shows how a "dispersion library" is specified for a model that can potentially have a beam as well as a bar.
</p>
<div class="org-src-container">
<pre class="src src-octave">Klib <span style="color: #b0c4de;">=</span> [struct(<span style="color: #ffa07a;">'K'</span><span style="color: #b0c4de;">,</span> @(w<span style="color: #b0c4de;">,</span>xi) sqrt(w)<span style="color: #b0c4de;">*</span>(rho<span style="color: #b0c4de;">*</span>Ar<span style="color: #b0c4de;">/</span>Ey<span style="color: #b0c4de;">/</span>Iy)<span style="color: #b0c4de;">^</span>(0.25))<span style="color: #b0c4de;">;</span>
                                struct(<span style="color: #ffa07a;">'K'</span><span style="color: #b0c4de;">,</span> @(w<span style="color: #b0c4de;">,</span>xi) w<span style="color: #b0c4de;">/</span>sqrt(Ey<span style="color: #b0c4de;">/</span>rho))]<span style="color: #b0c4de;">;</span>

wcomps_beam <span style="color: #b0c4de;">=</span> [1  1<span style="color: #b0c4de;">;</span>  <span style="color: #ff4500;">% First component  -&gt; exp(  k1 x )</span>
              <span style="color: #b0c4de;">-</span>1  1<span style="color: #b0c4de;">;</span>  <span style="color: #ff4500;">% Second component -&gt; exp( -k1 x )</span>
               1j 1<span style="color: #b0c4de;">;</span>  <span style="color: #ff4500;">% Third component  -&gt; exp( jk1 x )</span>
              <span style="color: #b0c4de;">-</span>1j 1]<span style="color: #b0c4de;">;</span> <span style="color: #ff4500;">% Fourth component -&gt; exp(-jk1 x )</span>

wcomps_bar <span style="color: #b0c4de;">=</span> [1j 2<span style="color: #b0c4de;">;</span>   <span style="color: #ff4500;">% First component  -&gt; exp( jk2 x )</span>
             <span style="color: #b0c4de;">-</span>1j 2]<span style="color: #b0c4de;">;</span>  <span style="color: #ff4500;">% Second component -&gt; exp(-jk2 x )</span>
</pre>
</div>
<p>
The <code>Klibs</code> variable is first constructed as an array of structs containing the dispersion relationships as function handles. Next, an \(N\times 2\) array <code>wcomps_beam</code> is created to specify how to use the dispersion relationships for each wave coefficient in the beam, and the same is done for the bar also (through <code>wcomps_bar</code>). The first column of these arrays stores the coefficient in front of \(k\) and the second column stores which element of the <code>Klibs</code> vector to choose for the current wave component. For instance, if a row is <code>[1j, 2]</code>, it says that the corresponding wave component's contribution to the solution is of the form \(a e^{jkx} e^{-j\omega t}\).
</p>

<p>
Note that at this point the <code>wcomps_beam</code> and <code>wcomps_bar</code> arrays are merely arrays and no explicit relationship with <code>Klibs</code> has been specified. This will be done while specifying the different "Pieces" of the model, as covered in Sec. <a href="#orgf46acc5">2.2</a> below.
</p>
</div>
</div>
<div id="outline-container-org7831a1a" class="outline-3">
<h3 id="org7831a1a"><span class="section-number-3">2.2.</span> Specification of the Pieces of a Model</h3>
<div class="outline-text-3" id="text-2-2">
<p>
<a id="orgf46acc5"></a>
</p>
</div>
</div>
<div id="outline-container-orge499aa9" class="outline-3">
<h3 id="orge499aa9"><span class="section-number-3">2.3.</span> Specification of Boundary Conditions</h3>
</div>
<div id="outline-container-orgec1578e" class="outline-3">
<h3 id="orgec1578e"><span class="section-number-3">2.4.</span> Specification of Joints</h3>
<div class="outline-text-3" id="text-2-4">
</div>
<div id="outline-container-org14953a5" class="outline-4">
<h4 id="org14953a5"><span class="section-number-4">2.4.1.</span> Fused Joints</h4>
</div>
<div id="outline-container-orgb48c09a" class="outline-4">
<h4 id="orgb48c09a"><span class="section-number-4">2.4.2.</span> Linear Joints</h4>
</div>
<div id="outline-container-org8a4a284" class="outline-4">
<h4 id="org8a4a284"><span class="section-number-4">2.4.3.</span> Nonlinear Joints</h4>
</div>
</div>
<div id="outline-container-orgb488f82" class="outline-3">
<h3 id="orgb488f82"><span class="section-number-3">2.5.</span> Computation of Linear Analysis Quantities</h3>
<div class="outline-text-3" id="text-2-5">
</div>
<div id="outline-container-org4b1e7c5" class="outline-4">
<h4 id="org4b1e7c5"><span class="section-number-4">2.5.1.</span> Linear Jacobian and Force vector</h4>
</div>
<div id="outline-container-orgef8c78c" class="outline-4">
<h4 id="orgef8c78c"><span class="section-number-4">2.5.2.</span> Linear Modal Analysis</h4>
</div>
</div>
<div id="outline-container-orgbdb3538" class="outline-3">
<h3 id="orgbdb3538"><span class="section-number-3">2.6.</span> Nonlinear Periodic Response Analysis</h3>
</div>
<div id="outline-container-org691242c" class="outline-3">
<h3 id="org691242c"><span class="section-number-3">2.7.</span> Continuation of Nonlinear Periodic Responses</h3>
<div class="outline-text-3" id="text-2-7">
</div>
<div id="outline-container-org9f65219" class="outline-4">
<h4 id="org9f65219"><span class="section-number-4">2.7.1.</span> Stability of Nonlinear Solutions</h4>
</div>
</div>
<div id="outline-container-org3d42c3a" class="outline-3">
<h3 id="org3d42c3a"><span class="section-number-3">2.8.</span> Post-Processing</h3>
</div>
<div id="outline-container-orga422968" class="outline-3">
<h3 id="orga422968"><span class="section-number-3">2.9.</span> Advanced Interfaces</h3>
<div class="outline-text-3" id="text-2-9">
</div>
<div id="outline-container-org4f816c8" class="outline-4">
<h4 id="org4f816c8"><span class="section-number-4">2.9.1.</span> Minimalized Representation</h4>
</div>
<div id="outline-container-orgd4f6af0" class="outline-4">
<h4 id="orgd4f6af0"><span class="section-number-4">2.9.2.</span> Quasi-Periodic Response Analysis</h4>
</div>
</div>
</div>
<div id="outline-container-org9a10c84" class="outline-2">
<h2 id="org9a10c84"><span class="section-number-2">3.</span> Examples</h2>
<div class="outline-text-2" id="text-3">
</div>
<div id="outline-container-org022442d" class="outline-3">
<h3 id="org022442d"><span class="section-number-3">3.1.</span> Single Bar</h3>
<div class="outline-text-3" id="text-3-1">
<p>
<a id="orge696e0c"></a>
This is by far the simplest example and can be used as a starting point to understand the usage of the tool. It conducts the analysis of a fixed-fixed 1D bar with the material properties in tab. <a href="#orgec697f7">1</a>.
</p>
<table id="orgec697f7" border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 1:</span> Material Properties for the example in <a href="https://github.com/Nidish96/wavevib/tree/master/EXAMPLES/a_singlebar.m">https://github.com/Nidish96/wavevib/tree/master/EXAMPLES/a<sub>singlebar.m</sub></a></caption>

<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">Young's Modulus (MPa)</th>
<th scope="col" class="org-right">Density (kg/m<sup>3</sup>)</th>
<th scope="col" class="org-right">Length (m)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">262</td>
<td class="org-right">1280</td>
<td class="org-right">1</td>
</tr>
</tbody>
</table>
</div>
<div id="outline-container-org9607658" class="outline-4">
<h4 id="org9607658"><span class="section-number-4">3.1.1.</span> Code Overview</h4>
<div class="outline-text-4" id="text-3-1-1">
<details class="code-details"
                 style ="padding: 1em;
                          background-color: #c9c9c9;
                          /* background-color: pink; */
                          border-radius: 15px;
                          color: hsl(157 75%);
                          font-size: 0.9em;
                          box-shadow: 0.05em 0.1em 5px 0.01em  #00000057;">
                  <summary>
                    <strong>
                      <font face="Courier" size="3" color="black">
                         Add the necessary directories to Path and Setup the model parameters
                      </font>
                    </strong>
                  </summary>
<div class="org-src-container">
<pre class="src src-octave"><span class="linenr"> 1: </span>clc
<span class="linenr"> 2: </span>clear all
<span class="linenr"> 3: </span>addpath(<span style="color: #ffa07a;">'../ROUTINES/SOLVERS/'</span>)
<span class="linenr"> 4: </span>addpath(<span style="color: #ffa07a;">'../ROUTINES/WBM/'</span>)
<span class="linenr"> 5: </span>
<span class="linenr"> 6: </span>set(0<span style="color: #b0c4de;">,</span><span style="color: #ffa07a;">'defaultAxesTickLabelInterpreter'</span><span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'default'</span>)<span style="color: #b0c4de;">;</span>
<span class="linenr"> 7: </span>set(0<span style="color: #b0c4de;">,</span><span style="color: #ffa07a;">'defaultTextInterpreter'</span><span style="color: #b0c4de;">,</span><span style="color: #ffa07a;">'latex'</span>)<span style="color: #b0c4de;">;</span>
<span class="linenr"> 8: </span>set(0<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'DefaultLegendInterpreter'</span><span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'latex'</span>)<span style="color: #b0c4de;">;</span>
<span class="linenr"> 9: </span>set(0<span style="color: #b0c4de;">,</span><span style="color: #ffa07a;">'defaultAxesFontSize'</span><span style="color: #b0c4de;">,</span>13)
<span class="linenr">10: </span>
<span class="linenr">11: </span><span style="color: #ff4500;">%</span><span style="color: #ff4500;">DESCRIPTION: This shows the most basic example of a 1D bar fixed at both</span>
<span class="linenr">12: </span><span style="color: #ff4500;">%</span><span style="color: #ff4500;">ends. </span>
<span class="linenr">13: </span>
<span class="linenr">14: </span><span style="color: #ff4500;">%% </span><span style="color: #ff4500;">Setup model</span>
<span class="linenr">15: </span>Ey <span style="color: #b0c4de;">=</span> 2.62e11<span style="color: #b0c4de;">;</span>
<span class="linenr">16: </span>rho <span style="color: #b0c4de;">=</span> 1280<span style="color: #b0c4de;">;</span>
<span class="linenr">17: </span>ell <span style="color: #b0c4de;">=</span> 1.0<span style="color: #b0c4de;">;</span>  
</pre>
</div>


</details>
<details class="code-details"
                 style ="padding: 1em;
                          background-color: white;
                          /* background-color: pink; */
                          border-radius: 15px;
                          color: hsl(157 75%);
                          font-size: 0.9em;
                          box-shadow: 0.05em 0.1em 5px 0.01em  #00000057;">
                  <summary>
                    <strong>
                      <font face="Courier" size="3" color="black">
                         Declare the dispersion relationship
                      </font>
                    </strong>
                  </summary>
<p>
The governing equations for the bar is
</p>
\begin{align}
\label{orged99fb2}
\rho \frac{\partial^2 u}{\partial t^2} - E_y \frac{\partial^2 u}{\partial x^2} &= 0 \qquad x\in (0, \ell)\\
u &= 0 \qquad x=0, \ell.
\end{align}
<p>
Using the standard ansatz $u(x,t)=\frac{U}{2} e<sup>j(kx-&omega; t)</sup>+c.c.$, the continuum domain yields the dispersion relationship,
</p>
\begin{equation}
\label{org091af19}
k(\omega) = \pm \frac{\omega}{\sqrt{E_y/\rho}}.
\end{equation}
<p>
This is provided to wavevib using the following code:
</p>
<div class="org-src-container">
<pre class="src src-octave"><span class="linenr">18: </span>Klib <span style="color: #b0c4de;">=</span> struct(<span style="color: #ffa07a;">'K'</span><span style="color: #b0c4de;">,</span> @(w<span style="color: #b0c4de;">,</span>xi) w<span style="color: #b0c4de;">/</span>sqrt(Ey<span style="color: #b0c4de;">/</span>rho))<span style="color: #b0c4de;">;</span>
<span class="linenr">19: </span>wcomps <span style="color: #b0c4de;">=</span> [1j 1<span style="color: #b0c4de;">;</span>  <span style="color: #ff4500;">% First component -&gt; exp( j k x )</span>
<span class="linenr">20: </span>         <span style="color: #b0c4de;">-</span>1j 1]<span style="color: #b0c4de;">;</span> <span style="color: #ff4500;">% Sec component   -&gt; exp(-j k x )</span>
</pre>
</div>
<p>
<code>Klib</code> is meant to be an array of structures, with each element holding a field <code>K</code> storing a function handle to a dispersion relationship that is parameterized by frequency <code>w</code> and some parameters (could be a vector of parameters) <code>xi</code>.
The matrix <code>wcomps</code> provides information about the different wave components. Each row corresponds to a different wave component (forward traveling and backward traveling axial waves in this case), with the first column being a premultiplier (typically \(\pm 1, \pm j\)) and the second column denoting the element of <code>Klib</code> to choose (here it is just 1). In the above, the two wave components are the forward traveling and backward traveling axial waves. Note that in the ansatz we have the temporal component occurring as \(e^{-j\omega t}\), meaning \(+j k\) implies forward traveling and \(-j k\) implies backward traveling in this notation.
</p>

<p>
Under this notation, the wave-based representation of the solution is,
</p>
\begin{equation}
\label{org5e8c1f2}
u(x,t) = (a^+ e^{jkx}+a^- e^{-jkx})e^{-j\omega t} + c.c.
\end{equation}


</details>
<details class="code-details"
                 style ="padding: 1em;
                          background-color: #c9c9c9;
                          /* background-color: pink; */
                          border-radius: 15px;
                          color: hsl(157 75%);
                          font-size: 0.9em;
                          box-shadow: 0.05em 0.1em 5px 0.01em  #00000057;">
                  <summary>
                    <strong>
                      <font face="Courier" size="3" color="black">
                         Setup the wave-based pieces
                      </font>
                    </strong>
                  </summary>
<p>
Now we setup the different continuum "pieces" in the model. Here we just have a single piece.
</p>
<div class="org-src-container">
<pre class="src src-octave"><span class="linenr">21: </span><span style="color: #ff4500;">% </span><span style="color: #ff4500;">Setup "wave-based pieces"</span>
<span class="linenr">22: </span>pcs <span style="color: #b0c4de;">=</span> struct(<span style="color: #ffa07a;">'coords'</span><span style="color: #b0c4de;">,</span> [0<span style="color: #b0c4de;">;</span>ell]<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'wcomps'</span><span style="color: #b0c4de;">,</span> wcomps)<span style="color: #b0c4de;">;</span>
<span class="linenr">23: </span><span style="color: #ff4500;">% </span><span style="color: #ff4500;">Note: The coordinates can be 3D also. The rows are interpreted as</span>
<span class="linenr">24: </span><span style="color: #ff4500;">% </span><span style="color: #ff4500;">individual points. Coordinates not given are assumed to be zeros.</span>
</pre>
</div>
<p>
The coordinates are strictly interpreted as though the rows are different points and columns (max. 3) are the cartesian coordinates of the point. If multiple columns are not given, they are assumed to be zero.
</p>

<p>
The <code>wcomps</code> matrix created before is supplied at this point. Each piece is associated with wave components defined in such a fashion. Note that different pieces in a single model <b>can</b> have different wave components, but this functionality has to be checked and possibly debugged first.
</p>


</details>
<details class="code-details"
                 style ="padding: 1em;
                          background-color: white;
                          /* background-color: pink; */
                          border-radius: 15px;
                          color: hsl(157 75%);
                          font-size: 0.9em;
                          box-shadow: 0.05em 0.1em 5px 0.01em  #00000057;">
                  <summary>
                    <strong>
                      <font face="Courier" size="3" color="black">
                         Setup the boundary conditions
                      </font>
                    </strong>
                  </summary>
<p>
A fixed boundary condition is given above in eq. \eqref{orged99fb2}. Employing the ansatz (eq. \eqref{org5e8c1f2}) at such a point yields
</p>
\begin{equation}
\label{orge69ab98}
u(0,t) = 0 \implies \begin{bmatrix} 1 & 1 \end{bmatrix} \begin{bmatrix} a^+\\ a^- \end{bmatrix} = 0
\end{equation}
<p>
as the wave-based representation of this boundary condition. The following code provides this information for wavevib.
</p>
<div class="org-src-container">
<pre class="src src-octave"><span class="linenr">25: </span><span style="color: #ff4500;">% </span><span style="color: #ff4500;">Setup Boundary Conditions</span>
<span class="linenr">26: </span>bcs <span style="color: #b0c4de;">=</span> [struct(<span style="color: #ffa07a;">'i'</span><span style="color: #b0c4de;">,</span> 1<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'cofs'</span><span style="color: #b0c4de;">,</span> @(w<span style="color: #b0c4de;">,</span>xi) [1 1])<span style="color: #b0c4de;">;</span> <span style="color: #ff4500;">% fixed end at point 1</span>
<span class="linenr">27: </span>    struct(<span style="color: #ffa07a;">'i'</span><span style="color: #b0c4de;">,</span> 2<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'cofs'</span><span style="color: #b0c4de;">,</span> @(w<span style="color: #b0c4de;">,</span>xi) [1 1])]<span style="color: #b0c4de;">;</span> <span style="color: #ff4500;">% fixed end at point 2</span>
<span class="linenr">28: </span><span style="color: #ff4500;">% </span><span style="color: #ff4500;">Note: The BC coefficients are given as function handles in two</span>
<span class="linenr">29: </span><span style="color: #ff4500;">% </span><span style="color: #ff4500;">parameters, (w,xi). The first is interpreted as frequency and the second</span>
<span class="linenr">30: </span><span style="color: #ff4500;">% </span><span style="color: #ff4500;">is left to the discretion of the user. The number of columns has to be</span>
<span class="linenr">31: </span><span style="color: #ff4500;">% </span><span style="color: #ff4500;">equal to the number of wave components in each case. </span>
</pre>
</div>
<p>
The parameter <code>i</code> denotes the point at which to apply the boundary condition (counted from the order given under the <code>pcs</code> structure), and <code>cofs</code> are the coefficients (functions of <code>(w,xi)</code>) as mentioned above.
</p>


</details>
<details class="code-details"
                 style ="padding: 1em;
                          background-color: #c9c9c9;
                          /* background-color: pink; */
                          border-radius: 15px;
                          color: hsl(157 75%);
                          font-size: 0.9em;
                          box-shadow: 0.05em 0.1em 5px 0.01em  #00000057;">
                  <summary>
                    <strong>
                      <font face="Courier" size="3" color="black">
                         Preprocess the inputs
                      </font>
                    </strong>
                  </summary>
<p>
Now that the required inputs have been prepared, waveVib has to "preprocess" the inputs to generate useful information. It is in this step that wavevib generates the required gradients of the provided coefficients. These derivatives are computed in <code>WaveVib</code> through Matlab's <code>symbolic toolbox</code> and then stored as anonymous functions. This might make the <code>WBPREPROC</code> function slightly slow to call, but during execution of the linear or nonlinear analyses, no symbolics is used and will thus be quite fast. This is because symbolics are used to compute the expressions only, but are not saved - these expressions are converted to regular matlab expressions before saving them.
</p>
<div class="org-src-container">
<pre class="src src-octave"><span class="linenr">32: </span><span style="color: #ff4500;">%% </span><span style="color: #ff4500;">Preprocess inputs</span>
<span class="linenr">33: </span><span style="color: #ff4500;">% </span><span style="color: #ff4500;">This step computes the analytical derivatives for expressions given above</span>
<span class="linenr">34: </span>[pcs<span style="color: #b0c4de;">,</span> bcs<span style="color: #b0c4de;">,</span> <span style="color: #b0c4de;">~,</span> <span style="color: #b0c4de;">~,</span> Klib] <span style="color: #b0c4de;">=</span> WBPREPROC(pcs<span style="color: #b0c4de;">,</span> bcs<span style="color: #b0c4de;">,</span> []<span style="color: #b0c4de;">,</span> []<span style="color: #b0c4de;">,</span> Klib)<span style="color: #b0c4de;">;</span>
<span class="linenr">35: </span><span style="color: #ff4500;">% </span><span style="color: #ff4500;">Note: the empty inputs are used to specify joints and excitation (see the</span>
<span class="linenr">36: </span><span style="color: #ff4500;">% </span><span style="color: #ff4500;">other examples)</span>
</pre>
</div>


</details>
<details class="code-details"
                 style ="padding: 1em;
                          background-color: white;
                          /* background-color: pink; */
                          border-radius: 15px;
                          color: hsl(157 75%);
                          font-size: 0.9em;
                          box-shadow: 0.05em 0.1em 5px 0.01em  #00000057;">
                  <summary>
                    <strong>
                      <font face="Courier" size="3" color="black">
                         Inspect the Linear Jacobian Determinant
                      </font>
                    </strong>
                  </summary>
<p>
The determinant of the linear Jacobian of this problem will have to be zero at resonance and non-zero elsewhere. We compute this at a range of frequency values and plot them.
</p>
<div class="org-src-container">
<pre class="src src-octave"><span class="linenr">37: </span><span style="color: #ff4500;">%% </span><span style="color: #ff4500;">Compute determinant of linear Jacobian</span>
<span class="linenr">38: </span>Nw <span style="color: #b0c4de;">=</span> 5000<span style="color: #b0c4de;">;</span>
<span class="linenr">39: </span>Ws <span style="color: #b0c4de;">=</span> linspace(0<span style="color: #b0c4de;">,</span> 1e6<span style="color: #b0c4de;">,</span> Nw)<span style="color: #b0c4de;">;</span>
<span class="linenr">40: </span>Ds <span style="color: #b0c4de;">=</span> zeros(1<span style="color: #b0c4de;">,</span>Nw)<span style="color: #b0c4de;">;</span>
<span class="linenr">41: </span><span style="color: #00ffff;">for</span> iw<span style="color: #b0c4de;">=</span>1<span style="color: #b0c4de;">:</span>Nw
<span class="linenr">42: </span>    Ds(iw) <span style="color: #b0c4de;">=</span> WVLDETFUN([Ws(iw)<span style="color: #b0c4de;">;</span>0]<span style="color: #b0c4de;">,</span> 1<span style="color: #b0c4de;">,</span> pcs<span style="color: #b0c4de;">,</span> bcs<span style="color: #b0c4de;">,</span> []<span style="color: #b0c4de;">,</span> Klib)<span style="color: #b0c4de;">;</span>
<span class="linenr">43: </span><span style="color: #00ffff;">end</span>
<span class="linenr">44: </span>
<span class="linenr">45: </span><span style="color: #ff4500;">%% </span><span style="color: #ff4500;">Plot</span>
<span class="linenr">46: </span>figure(1)
<span class="linenr">47: </span>clf()
<span class="linenr">48: </span>semilogy(Ws<span style="color: #b0c4de;">,</span> Ds<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'-'</span>)
<span class="linenr">49: </span>xlabel(<span style="color: #ffa07a;">'Frequncy (rad/s)'</span>)
<span class="linenr">50: </span>ylabel(<span style="color: #ffa07a;">'Jacobian Determinant'</span>)
</pre>
</div>

<p>
At any such singular point, one may inspect the mode shape by looking at the null space of the matrix.
</p>


</details>
</div>
</div>
<div id="outline-container-org2e0773d" class="outline-4">
<h4 id="org2e0773d"><span class="section-number-4">3.1.2.</span> Results</h4>
<div class="outline-text-4" id="text-3-1-2">
<p>
Fig. <a href="#org4fa7930">2</a> presents the determinant plotted for different frequency values in log-scale. All the points where drop-offs are seen are the resonances.
</p>

<div id="org4fa7930" class="figure">
<p><img src="./FIGS/a_out.png" alt="a_out.png" width="600px" />
</p>
<p><span class="figure-number">Figure 2: </span>Jacobian determinant for the linear bar example</p>
</div>
</div>
</div>
<div id="outline-container-org795b9eb" class="outline-4">
<h4 id="org795b9eb"><span class="section-number-4">3.1.3.</span> <span class="todo TODO">TODO</span> Show mode-shapes in results</h4>
</div>
</div>
<div id="outline-container-org2541a1a" class="outline-3">
<h3 id="org2541a1a"><span class="section-number-3">3.2.</span> Linear-Jointed Bars</h3>
<div class="outline-text-3" id="text-3-2">
<p>
<a id="org25352c7"></a>
We will next look at the example of linear jointed bars. This is a simplified version of the nonlinear system considered in <a href="#citeproc_bib_item_1">[1]</a>.
</p>
</div>
<div id="outline-container-org916a08e" class="outline-4">
<h4 id="org916a08e"><span class="section-number-4">3.2.1.</span> Code Overview</h4>
<div class="outline-text-4" id="text-3-2-1">
<details class="code-details"
                 style ="padding: 1em;
                          background-color: #c9c9c9;
                          /* background-color: pink; */
                          border-radius: 15px;
                          color: hsl(157 75%);
                          font-size: 0.9em;
                          box-shadow: 0.05em 0.1em 5px 0.01em  #00000057;">
                  <summary>
                    <strong>
                      <font face="Courier" size="3" color="black">
                         Setup the parameters, dispersion, and boundary conditions
                      </font>
                    </strong>
                  </summary>
<p>
The initial setup is very similar to that in sec. <a href="#orge696e0c">3.1</a>.
</p>
<div class="org-src-container">
<pre class="src src-octave"><span class="linenr"> 1: </span>addpath(<span style="color: #ffa07a;">'../ROUTINES/SOLVERS/'</span>)
<span class="linenr"> 2: </span>addpath(<span style="color: #ffa07a;">'../ROUTINES/WBM/'</span>)
<span class="linenr"> 3: </span>
<span class="linenr"> 4: </span>set(0<span style="color: #b0c4de;">,</span><span style="color: #ffa07a;">'defaultAxesTickLabelInterpreter'</span><span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'default'</span>)<span style="color: #b0c4de;">;</span>
<span class="linenr"> 5: </span>set(0<span style="color: #b0c4de;">,</span><span style="color: #ffa07a;">'defaultTextInterpreter'</span><span style="color: #b0c4de;">,</span><span style="color: #ffa07a;">'latex'</span>)<span style="color: #b0c4de;">;</span>
<span class="linenr"> 6: </span>set(0<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'DefaultLegendInterpreter'</span><span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'latex'</span>)<span style="color: #b0c4de;">;</span>
<span class="linenr"> 7: </span>set(0<span style="color: #b0c4de;">,</span><span style="color: #ffa07a;">'defaultAxesFontSize'</span><span style="color: #b0c4de;">,</span>13)
<span class="linenr"> 8: </span>
<span class="linenr"> 9: </span><span style="color: #ff4500;">%</span><span style="color: #ff4500;">DESCRIPTION: This shows the linear forced response computation for the 1D</span>
<span class="linenr">10: </span><span style="color: #ff4500;">%</span><span style="color: #ff4500;">bar example considered in Balaji, Brake, Leamy (2022a,2022b)</span>
<span class="linenr">11: </span>
<span class="linenr">12: </span><span style="color: #ff4500;">%% </span><span style="color: #ff4500;">Setup model</span>
<span class="linenr">13: </span>Ey <span style="color: #b0c4de;">=</span> 2.62e11<span style="color: #b0c4de;">;</span>
<span class="linenr">14: </span>rho <span style="color: #b0c4de;">=</span> 1280<span style="color: #b0c4de;">;</span>
<span class="linenr">15: </span>ell <span style="color: #b0c4de;">=</span> 1.0<span style="color: #b0c4de;">;</span>
<span class="linenr">16: </span>Ar <span style="color: #b0c4de;">=</span> 31.75e<span style="color: #b0c4de;">-</span>3<span style="color: #b0c4de;">*</span>54e<span style="color: #b0c4de;">-</span>3<span style="color: #b0c4de;">;</span>
<span class="linenr">17: </span>Klib <span style="color: #b0c4de;">=</span> struct(<span style="color: #ffa07a;">'K'</span><span style="color: #b0c4de;">,</span> @(w<span style="color: #b0c4de;">,</span>xi) w<span style="color: #b0c4de;">/</span>sqrt(Ey<span style="color: #b0c4de;">/</span>rho))<span style="color: #b0c4de;">;</span>
<span class="linenr">18: </span>wcomps <span style="color: #b0c4de;">=</span> [1j 1<span style="color: #b0c4de;">;</span>  <span style="color: #ff4500;">% First component -&gt; exp( j k x )</span>
<span class="linenr">19: </span>         <span style="color: #b0c4de;">-</span>1j 1]<span style="color: #b0c4de;">;</span> <span style="color: #ff4500;">% Sec component   -&gt; exp(-j k x )</span>
<span class="linenr">20: </span>
<span class="linenr">21: </span><span style="color: #ff4500;">% </span><span style="color: #ff4500;">Setup "wave-based pieces"</span>
<span class="linenr">22: </span>pcs <span style="color: #b0c4de;">=</span> [struct(<span style="color: #ffa07a;">'coords'</span><span style="color: #b0c4de;">,</span> [0<span style="color: #b0c4de;">;</span>0.28<span style="color: #b0c4de;">;</span>ell<span style="color: #b0c4de;">/</span>3]<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'wcomps'</span><span style="color: #b0c4de;">,</span> wcomps)<span style="color: #b0c4de;">;</span>
<span class="linenr">23: </span>    struct(<span style="color: #ffa07a;">'coords'</span><span style="color: #b0c4de;">,</span> [ell<span style="color: #b0c4de;">/</span>3<span style="color: #b0c4de;">;</span>ell]<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'wcomps'</span><span style="color: #b0c4de;">,</span> wcomps)]<span style="color: #b0c4de;">;</span>
<span class="linenr">24: </span>
<span class="linenr">25: </span><span style="color: #ff4500;">% </span><span style="color: #ff4500;">Setup Boundary Conditions (pts indexed as given above in sequence)</span>
<span class="linenr">26: </span>bcs <span style="color: #b0c4de;">=</span> [struct(<span style="color: #ffa07a;">'i'</span><span style="color: #b0c4de;">,</span> 1<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'cofs'</span><span style="color: #b0c4de;">,</span> @(w<span style="color: #b0c4de;">,</span>xi) [1 1])<span style="color: #b0c4de;">;</span>
<span class="linenr">27: </span>    struct(<span style="color: #ffa07a;">'i'</span><span style="color: #b0c4de;">,</span> 5<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'cofs'</span><span style="color: #b0c4de;">,</span> @(w<span style="color: #b0c4de;">,</span>xi) [1 1])]<span style="color: #b0c4de;">;</span>
</pre>
</div>
<p>
The only difference here is that unlike the first example, this example consists of two pieces - one in \(x\in [0,\ell/3]\) and the second in \(x\in [\ell/3,\ell]\). These are provided by assigning <code>pcs</code> to an array of structs.
</p>


</details>
<details class="code-details"
                 style ="padding: 1em;
                          background-color: white;
                          /* background-color: pink; */
                          border-radius: 15px;
                          color: hsl(157 75%);
                          font-size: 0.9em;
                          box-shadow: 0.05em 0.1em 5px 0.01em  #00000057;">
                  <summary>
                    <strong>
                      <font face="Courier" size="3" color="black">
                         Setup the linear joint
                      </font>
                    </strong>
                  </summary>
<p>
We now setup the joint and specify its linear properties (stiffness and damping coefficients). Note that the wave-based approach assumes the joint be treated as a measure-zero feature. This is a necessary condition since if the "joint" was not measure zero, then the dispersion relationship will no longer hold there and a different representation will be warranted there.
</p>
<div class="org-src-container">
<pre class="src src-octave"><span class="linenr">28: </span><span style="color: #ff4500;">%% </span><span style="color: #ff4500;">Setup the linear Joint</span>
<span class="linenr">29: </span>kJ <span style="color: #b0c4de;">=</span> 1e9<span style="color: #b0c4de;">;</span>
<span class="linenr">30: </span>cJ <span style="color: #b0c4de;">=</span> 320<span style="color: #b0c4de;">;</span>
<span class="linenr">31: </span>cofs <span style="color: #b0c4de;">=</span> @(w<span style="color: #b0c4de;">,</span>xi) [(1j<span style="color: #b0c4de;">*</span>Klib.K(w<span style="color: #b0c4de;">,</span>xi)<span style="color: #b0c4de;">*</span>Ey<span style="color: #b0c4de;">*</span>Ar)<span style="color: #b0c4de;">*</span>[1<span style="color: #b0c4de;">,</span> <span style="color: #b0c4de;">-</span>1<span style="color: #b0c4de;">,</span> 0<span style="color: #b0c4de;">,</span> 0] <span style="color: #b0c4de;">+...</span>
<span class="linenr">32: </span>    (kJ<span style="color: #b0c4de;">-</span>1j<span style="color: #b0c4de;">*</span>cJ<span style="color: #b0c4de;">*</span>w)<span style="color: #b0c4de;">*</span>[1 1 <span style="color: #b0c4de;">-</span>1 <span style="color: #b0c4de;">-</span>1]<span style="color: #b0c4de;">;</span>1<span style="color: #b0c4de;">,</span> <span style="color: #b0c4de;">-</span>1<span style="color: #b0c4de;">,</span> <span style="color: #b0c4de;">-</span>1<span style="color: #b0c4de;">,</span> 1]<span style="color: #b0c4de;">;</span>
<span class="linenr">33: </span><span style="color: #ff4500;">% </span><span style="color: #ff4500;">Coefficients are to be supplied such that </span>
<span class="linenr">34: </span><span style="color: #ff4500;">% </span><span style="color: #ff4500;">COFS*a = 0    represents the joint, where</span>
<span class="linenr">35: </span><span style="color: #ff4500;">% </span><span style="color: #ff4500;">a is the vector of the wave coefficients of the two pts.</span>
<span class="linenr">36: </span>joints <span style="color: #b0c4de;">=</span> struct(<span style="color: #ffa07a;">'type'</span><span style="color: #b0c4de;">,</span> 2<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'i'</span><span style="color: #b0c4de;">,</span> 3<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'j'</span><span style="color: #b0c4de;">,</span> 4<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'cofs'</span><span style="color: #b0c4de;">,</span> cofs)<span style="color: #b0c4de;">;</span>
<span class="linenr">37: </span><span style="color: #ff4500;">%</span><span style="color: #ff4500;">NOTE: The 'type' parameter specifies how many points are joined at this</span>
<span class="linenr">38: </span><span style="color: #ff4500;">%</span><span style="color: #ff4500;">location.</span>
</pre>
</div>
<p>
A joint joining two points (a <code>type 2</code> joint) is specified by providing the two points that are connected and a coefficient matrix (function of <code>(w, xi)</code>) such that
\[ cofs \begin{bmatrix} \bar{a}\\ \bar{b} \end{bmatrix} = \bar{0}, \]
where \(\bar{a}\) and \(\bar{b}\) are the vector of wave coefficients at the two points involved. 
</p>


</details>
<details class="code-details"
                 style ="padding: 1em;
                          background-color: #c9c9c9;
                          /* background-color: pink; */
                          border-radius: 15px;
                          color: hsl(157 75%);
                          font-size: 0.9em;
                          box-shadow: 0.05em 0.1em 5px 0.01em  #00000057;">
                  <summary>
                    <strong>
                      <font face="Courier" size="3" color="black">
                         Setup excitation
                      </font>
                    </strong>
                  </summary>
<p>
Unlike the previous example, this system also has excitation that we setup using the following piece of code:
</p>
<div class="org-src-container">
<pre class="src src-octave"><span class="linenr">39: </span><span style="color: #ff4500;">%% </span><span style="color: #ff4500;">Setup Excitation</span>
<span class="linenr">40: </span>excs <span style="color: #b0c4de;">=</span> struct(<span style="color: #ffa07a;">'i'</span><span style="color: #b0c4de;">,</span> 2<span style="color: #b0c4de;">,</span> <span style="color: #b0c4de;">...</span>
<span class="linenr">41: </span>    <span style="color: #ffa07a;">'rcofs'</span><span style="color: #b0c4de;">,</span> @(w<span style="color: #b0c4de;">,</span>xi) (1<span style="color: #b0c4de;">/</span>2<span style="color: #b0c4de;">/</span>(2j<span style="color: #b0c4de;">*</span>Klib.K(w<span style="color: #b0c4de;">,</span>xi)<span style="color: #b0c4de;">*</span>Ey<span style="color: #b0c4de;">*</span>Ar))<span style="color: #b0c4de;">*</span>[<span style="color: #b0c4de;">-</span>1<span style="color: #b0c4de;">;</span>1])<span style="color: #b0c4de;">;</span>
<span class="linenr">42: </span><span style="color: #ff4500;">%</span><span style="color: #ff4500;">'i' specifies the point of excitation. </span>
<span class="linenr">43: </span><span style="color: #ff4500;">%</span><span style="color: #ff4500;">'rcofs' specifies the coefficients in the RHS of the eqn such that,</span>
<span class="linenr">44: </span><span style="color: #ff4500;">%   </span><span style="color: #ff4500;">[I -I]*[a;b] = rcofs        represents the excitation.</span>
<span class="linenr">45: </span><span style="color: #ff4500;">%   </span><span style="color: #ff4500;">where "a" and "b" are the vector of wave coefficients just before and</span>
<span class="linenr">46: </span><span style="color: #ff4500;">%   </span><span style="color: #ff4500;">after the point of excitation.</span>
</pre>
</div>
<p>
The meaning of the different terms are as explained in the comments above.
</p>


</details>
<details class="code-details"
                 style ="padding: 1em;
                          background-color: white;
                          /* background-color: pink; */
                          border-radius: 15px;
                          color: hsl(157 75%);
                          font-size: 0.9em;
                          box-shadow: 0.05em 0.1em 5px 0.01em  #00000057;">
                  <summary>
                    <strong>
                      <font face="Courier" size="3" color="black">
                         Conduct Preprocessing
                      </font>
                    </strong>
                  </summary>
<div class="org-src-container">
<pre class="src src-octave"><span class="linenr">47: </span><span style="color: #ff4500;">%% </span><span style="color: #ff4500;">Preprocess Everything</span>
<span class="linenr">48: </span>[pcs<span style="color: #b0c4de;">,</span> bcs<span style="color: #b0c4de;">,</span> joints<span style="color: #b0c4de;">,</span> excs<span style="color: #b0c4de;">,</span> Klib] <span style="color: #b0c4de;">=</span> WBPREPROC(pcs<span style="color: #b0c4de;">,</span> bcs<span style="color: #b0c4de;">,</span> joints<span style="color: #b0c4de;">,</span> excs<span style="color: #b0c4de;">,</span> Klib)<span style="color: #b0c4de;">;</span>
<span class="linenr">49: </span>Nwc <span style="color: #b0c4de;">=</span> size(wcomps<span style="color: #b0c4de;">,</span>1)<span style="color: #b0c4de;">;</span>  <span style="color: #ff4500;">% Number of wave components</span>
</pre>
</div>


</details>
<details class="code-details"
                 style ="padding: 1em;
                          background-color: #c9c9c9;
                          /* background-color: pink; */
                          border-radius: 15px;
                          color: hsl(157 75%);
                          font-size: 0.9em;
                          box-shadow: 0.05em 0.1em 5px 0.01em  #00000057;">
                  <summary>
                    <strong>
                      <font face="Courier" size="3" color="black">
                         Linear forced response analysis
                      </font>
                    </strong>
                  </summary>
<p>
We now conduct the forced response analysis for a list of frequency values. The key routine here is <a href="https://github.com/Nidish96/wavevib/tree/master/ROUTINES/WBM/WVAMAT.m">WVAMAT</a>, which computes the linear Jacobian and the Linear forcing vector. These can be linsolved to obtain the forced response, as is done here.
</p>
<div class="org-src-container">
<pre class="src src-octave"><span class="linenr">50: </span><span style="color: #ff4500;">%% </span><span style="color: #ff4500;">Conduct Linear Forced Response Analysis</span>
<span class="linenr">51: </span>Nw <span style="color: #b0c4de;">=</span> 1000<span style="color: #b0c4de;">;</span>
<span class="linenr">52: </span>Ws <span style="color: #b0c4de;">=</span> linspace(0<span style="color: #b0c4de;">,</span> 1e5<span style="color: #b0c4de;">,</span> Nw)<span style="color: #b0c4de;">;</span>
<span class="linenr">53: </span>Npts <span style="color: #b0c4de;">=</span> pcs(end).irange(end)<span style="color: #b0c4de;">;</span>  <span style="color: #ff4500;">% Total number of points. </span>
<span class="linenr">54: </span>                              <span style="color: #ff4500;">% Note: This is NOT the same as before. </span>
<span class="linenr">55: </span>                              <span style="color: #ff4500;">% Preprocessing usually adds more/reorders points.</span>
<span class="linenr">56: </span>ACs <span style="color: #b0c4de;">=</span> zeros(Npts<span style="color: #b0c4de;">*</span>Nwc<span style="color: #b0c4de;">,</span>Nw)<span style="color: #b0c4de;">;</span>
<span class="linenr">57: </span>
<span class="linenr">58: </span>Famp <span style="color: #b0c4de;">=</span> 150e5<span style="color: #b0c4de;">;</span>  <span style="color: #ff4500;">% 15MN Excitation amplitude</span>
<span class="linenr">59: </span><span style="color: #00ffff;">for</span> iw<span style="color: #b0c4de;">=</span>1<span style="color: #b0c4de;">:</span>Nw
<span class="linenr">60: </span>    <span style="color: #ff4500;">% The following function calculates the "A" matrix and the "Force"</span>
<span class="linenr">61: </span>    <span style="color: #ff4500;">% vector (both complex). An argument 'r' can be passed as the last</span>
<span class="linenr">62: </span>    <span style="color: #ff4500;">% argument to obtain everything in real form (real and imaginary parts </span>
<span class="linenr">63: </span>    <span style="color: #ff4500;">% stored separately). "Fv" is the force vector assuming unit</span>
<span class="linenr">64: </span>    <span style="color: #ff4500;">% excitation.</span>
<span class="linenr">65: </span>    [Amat<span style="color: #b0c4de;">,</span> <span style="color: #b0c4de;">~,</span> <span style="color: #b0c4de;">~,</span> Fv] <span style="color: #b0c4de;">=</span> WVAMAT([Ws(iw)<span style="color: #b0c4de;">;</span>0]<span style="color: #b0c4de;">,</span> 1<span style="color: #b0c4de;">,</span> pcs<span style="color: #b0c4de;">,</span> bcs<span style="color: #b0c4de;">,</span> joints<span style="color: #b0c4de;">,</span> Klib)<span style="color: #b0c4de;">;</span>
<span class="linenr">66: </span>    ACs(<span style="color: #b0c4de;">:,</span>iw) <span style="color: #b0c4de;">=</span> Amat<span style="color: #b0c4de;">\</span>(Fv<span style="color: #b0c4de;">*</span>Famp)<span style="color: #b0c4de;">;</span>
<span class="linenr">67: </span><span style="color: #00ffff;">end</span>
</pre>
</div>
<p>
The results are then plotted for the point right after the joint using the following code.
</p>
<div class="org-src-container">
<pre class="src src-octave"><span class="linenr">68: </span><span style="color: #ff4500;">%% </span><span style="color: #ff4500;">Plot Forced Response</span>
<span class="linenr">69: </span>opi <span style="color: #b0c4de;">=</span> 9<span style="color: #b0c4de;">:</span>10<span style="color: #b0c4de;">;</span>  <span style="color: #ff4500;">% Output wave coefficients</span>
<span class="linenr">70: </span>figure(1)
<span class="linenr">71: </span>clf()
<span class="linenr">72: </span>subplot(2<span style="color: #b0c4de;">,</span>1<span style="color: #b0c4de;">,</span>1)
<span class="linenr">73: </span>semilogy(Ws<span style="color: #b0c4de;">/</span>1e3<span style="color: #b0c4de;">,</span> abs(2<span style="color: #b0c4de;">*</span>sum(ACs(opi<span style="color: #b0c4de;">,:</span>))))<span style="color: #b0c4de;">;</span>
<span class="linenr">74: </span>grid on
<span class="linenr">75: </span>ylabel(<span style="color: #ffa07a;">'Response (m)'</span>)
<span class="linenr">76: </span>subplot(2<span style="color: #b0c4de;">,</span>1<span style="color: #b0c4de;">,</span>2)
<span class="linenr">77: </span>plot(Ws<span style="color: #b0c4de;">/</span>1e3<span style="color: #b0c4de;">,</span> rad2deg(angle(2<span style="color: #b0c4de;">*</span>sum(ACs(opi<span style="color: #b0c4de;">,:</span>)))))<span style="color: #b0c4de;">;</span>
<span class="linenr">78: </span>grid on
<span class="linenr">79: </span>set(gca<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'YTick'</span><span style="color: #b0c4de;">,</span> <span style="color: #b0c4de;">-</span>180<span style="color: #b0c4de;">:</span>90<span style="color: #b0c4de;">:</span>180)
<span class="linenr">80: </span>ylabel(<span style="color: #ffa07a;">'Phase (degs)'</span>)
<span class="linenr">81: </span>xlabel(<span style="color: #ffa07a;">'Frequency (k rad/s)'</span>)
</pre>
</div>


</details>
</div>
</div>
<div id="outline-container-orge57ca44" class="outline-4">
<h4 id="orge57ca44"><span class="section-number-4">3.2.2.</span> Results</h4>
<div class="outline-text-4" id="text-3-2-2">
<p>
Fig. <a href="#org79213ff">3</a> presents the linear forced response for this system (results have been validated against the analytical results). 
</p>

<div id="org79213ff" class="figure">
<p><img src="./FIGS/b_out.png" alt="b_out.png" width="600px" />
</p>
<p><span class="figure-number">Figure 3: </span>Linear forced response of the linear-jointed bar.</p>
</div>
</div>
</div>
<div id="outline-container-orgb57a02a" class="outline-4">
<h4 id="orgb57a02a"><span class="section-number-4">3.2.3.</span> <span class="todo TODO">TODO</span> Include a nicely labeled diagram in the description.</h4>
</div>
<div id="outline-container-org867bc49" class="outline-4">
<h4 id="org867bc49"><span class="section-number-4">3.2.4.</span> <span class="todo TODO">TODO</span> Describe how to use WVEVALWCOFS for evaluating wave coefficients and plot deflection shape.</h4>
</div>
</div>
<div id="outline-container-org4a2f825" class="outline-3">
<h3 id="org4a2f825"><span class="section-number-3">3.3.</span> Nonlinear-Jointed Bars</h3>
<div class="outline-text-3" id="text-3-3">
<p>
<a id="org7fe6f82"></a>
This is the first nonlinear jointed example. This is the exact same example considered in <a href="#citeproc_bib_item_1">[1]</a>. 
</p>
</div>
<div id="outline-container-orgc940a33" class="outline-4">
<h4 id="orgc940a33"><span class="section-number-4">3.3.1.</span> Code Overview</h4>
<div class="outline-text-4" id="text-3-3-1">
<details class="code-details"
                 style ="padding: 1em;
                          background-color: #c9c9c9;
                          /* background-color: pink; */
                          border-radius: 15px;
                          color: hsl(157 75%);
                          font-size: 0.9em;
                          box-shadow: 0.05em 0.1em 5px 0.01em  #00000057;">
                  <summary>
                    <strong>
                      <font face="Courier" size="3" color="black">
                         Setup the model
                      </font>
                    </strong>
                  </summary>
<p>
The initial setup is identical to that for sec. <a href="#org25352c7">3.2</a> since the model is the same.
</p>
<div class="org-src-container">
<pre class="src src-octave"><span class="linenr"> 1: </span>addpath(<span style="color: #ffa07a;">'../ROUTINES/SOLVERS/'</span>)
<span class="linenr"> 2: </span>addpath(<span style="color: #ffa07a;">'../ROUTINES/WBM/'</span>)
<span class="linenr"> 3: </span>
<span class="linenr"> 4: </span><span style="color: #ff4500;">%</span><span style="color: #ff4500;">DESCRIPTION: This shows the non-linear forced response computation for </span>
<span class="linenr"> 5: </span><span style="color: #ff4500;">%</span><span style="color: #ff4500;">the 1D bar example considered in Balaji, Brake, Leamy (2022a,2022b)</span>
<span class="linenr"> 6: </span>
<span class="linenr"> 7: </span><span style="color: #ff4500;">%% </span><span style="color: #ff4500;">Setup model</span>
<span class="linenr"> 8: </span>Ey <span style="color: #b0c4de;">=</span> 2.62e11<span style="color: #b0c4de;">;</span>
<span class="linenr"> 9: </span>rho <span style="color: #b0c4de;">=</span> 1280<span style="color: #b0c4de;">;</span>
<span class="linenr">10: </span>ell <span style="color: #b0c4de;">=</span> 1.0<span style="color: #b0c4de;">;</span>
<span class="linenr">11: </span>Ar <span style="color: #b0c4de;">=</span> 31.75e<span style="color: #b0c4de;">-</span>3<span style="color: #b0c4de;">*</span>54e<span style="color: #b0c4de;">-</span>3<span style="color: #b0c4de;">;</span>
<span class="linenr">12: </span>Klib <span style="color: #b0c4de;">=</span> struct(<span style="color: #ffa07a;">'K'</span><span style="color: #b0c4de;">,</span> @(w<span style="color: #b0c4de;">,</span>xi) w<span style="color: #b0c4de;">/</span>sqrt(Ey<span style="color: #b0c4de;">/</span>rho))<span style="color: #b0c4de;">;</span>
<span class="linenr">13: </span>wcomps <span style="color: #b0c4de;">=</span> [1j 1<span style="color: #b0c4de;">;</span>  <span style="color: #ff4500;">% First component -&gt; exp( j k x )</span>
<span class="linenr">14: </span>         <span style="color: #b0c4de;">-</span>1j 1]<span style="color: #b0c4de;">;</span> <span style="color: #ff4500;">% Sec component   -&gt; exp(-j k x )</span>
<span class="linenr">15: </span>
<span class="linenr">16: </span><span style="color: #ff4500;">% </span><span style="color: #ff4500;">Setup "wave-based pieces"</span>
<span class="linenr">17: </span>pcs <span style="color: #b0c4de;">=</span> [struct(<span style="color: #ffa07a;">'coords'</span><span style="color: #b0c4de;">,</span> [0<span style="color: #b0c4de;">;</span>0.28<span style="color: #b0c4de;">;</span>ell<span style="color: #b0c4de;">/</span>3]<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'wcomps'</span><span style="color: #b0c4de;">,</span> wcomps)<span style="color: #b0c4de;">;</span>
<span class="linenr">18: </span>    struct(<span style="color: #ffa07a;">'coords'</span><span style="color: #b0c4de;">,</span> [ell<span style="color: #b0c4de;">/</span>3<span style="color: #b0c4de;">;</span>ell]<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'wcomps'</span><span style="color: #b0c4de;">,</span> wcomps)]<span style="color: #b0c4de;">;</span>
<span class="linenr">19: </span>
<span class="linenr">20: </span><span style="color: #ff4500;">% </span><span style="color: #ff4500;">Setup Boundary Conditions (pts indexed as given above in sequence)</span>
<span class="linenr">21: </span>bcs <span style="color: #b0c4de;">=</span> [struct(<span style="color: #ffa07a;">'i'</span><span style="color: #b0c4de;">,</span> 1<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'cofs'</span><span style="color: #b0c4de;">,</span> @(w<span style="color: #b0c4de;">,</span>xi) [1 1])<span style="color: #b0c4de;">;</span>
<span class="linenr">22: </span>    struct(<span style="color: #ffa07a;">'i'</span><span style="color: #b0c4de;">,</span> 5<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'cofs'</span><span style="color: #b0c4de;">,</span> @(w<span style="color: #b0c4de;">,</span>xi) [1 1])]<span style="color: #b0c4de;">;</span>
<span class="linenr">23: </span>
<span class="linenr">24: </span><span style="color: #ff4500;">% </span><span style="color: #ff4500;">Setup Excitation</span>
<span class="linenr">25: </span>excs <span style="color: #b0c4de;">=</span> struct(<span style="color: #ffa07a;">'i'</span><span style="color: #b0c4de;">,</span> 2<span style="color: #b0c4de;">,</span> <span style="color: #b0c4de;">...</span>
<span class="linenr">26: </span>    <span style="color: #ffa07a;">'rcofs'</span><span style="color: #b0c4de;">,</span> @(w<span style="color: #b0c4de;">,</span>xi) (1<span style="color: #b0c4de;">/</span>2<span style="color: #b0c4de;">/</span>(2j<span style="color: #b0c4de;">*</span>Klib.K(w<span style="color: #b0c4de;">,</span>xi)<span style="color: #b0c4de;">*</span>Ey<span style="color: #b0c4de;">*</span>Ar))<span style="color: #b0c4de;">*</span>[<span style="color: #b0c4de;">-</span>1<span style="color: #b0c4de;">;</span>1])<span style="color: #b0c4de;">;</span>
</pre>
</div>


</details>
<details class="code-details"
                 style ="padding: 1em;
                          background-color: white;
                          /* background-color: pink; */
                          border-radius: 15px;
                          color: hsl(157 75%);
                          font-size: 0.9em;
                          box-shadow: 0.05em 0.1em 5px 0.01em  #00000057;">
                  <summary>
                    <strong>
                      <font face="Courier" size="3" color="black">
                         Setup the nonlinear joint
                      </font>
                    </strong>
                  </summary>
<p>
Some more care is necessary for setting up the joint since this has nonlinear behavior modeled as a cubic spring in parallel with linear stiffness and damping terms. First setup the AFT properties:
</p>
<div class="org-src-container">
<pre class="src src-octave"><span class="linenr">27: </span><span style="color: #ff4500;">%% </span><span style="color: #ff4500;">Setup AFT properties</span>
<span class="linenr">28: </span>h <span style="color: #b0c4de;">=</span> sort([1<span style="color: #b0c4de;">;</span> 3])<span style="color: #b0c4de;">;</span>  <span style="color: #ff4500;">% List of harmonics to consider for simulation. </span>
<span class="linenr">29: </span>Nt <span style="color: #b0c4de;">=</span> 128<span style="color: #b0c4de;">;</span>  <span style="color: #ff4500;">% Number of points for Alternating Frequency-Time calculations.</span>
</pre>
</div>
<p>
Now setup the relevant coefficients and nonlinearity function for the joint.
</p>
<div class="org-src-container">
<pre class="src src-octave"><span class="linenr">30: </span><span style="color: #ff4500;">%% </span><span style="color: #ff4500;">Setup the Nonlinear Joint</span>
<span class="linenr">31: </span>kJ <span style="color: #b0c4de;">=</span> 1e9<span style="color: #b0c4de;">;</span>
<span class="linenr">32: </span>cJ <span style="color: #b0c4de;">=</span> 320<span style="color: #b0c4de;">;</span>
<span class="linenr">33: </span>gJ <span style="color: #b0c4de;">=</span> 1e8<span style="color: #b0c4de;">;</span>
<span class="linenr">34: </span>cofs <span style="color: #b0c4de;">=</span> @(w<span style="color: #b0c4de;">,</span>xi) [1j<span style="color: #b0c4de;">*</span>Klib.K(w<span style="color: #b0c4de;">,</span>xi)<span style="color: #b0c4de;">*</span>[1 <span style="color: #b0c4de;">-</span>1 0 0]<span style="color: #b0c4de;">;</span>1 <span style="color: #b0c4de;">-</span>1 <span style="color: #b0c4de;">-</span>1 1]<span style="color: #b0c4de;">;</span>
<span class="linenr">35: </span>joints <span style="color: #b0c4de;">=</span> struct(<span style="color: #ffa07a;">'type'</span><span style="color: #b0c4de;">,</span> 2<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'i'</span><span style="color: #b0c4de;">,</span> 3<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'j'</span><span style="color: #b0c4de;">,</span> 4<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'cofs'</span><span style="color: #b0c4de;">,</span> cofs<span style="color: #b0c4de;">,</span> <span style="color: #b0c4de;">...</span>
<span class="linenr">36: </span>    <span style="color: #ffa07a;">'nl'</span><span style="color: #b0c4de;">,</span> @(Uw) HDUFF(Uw<span style="color: #b0c4de;">,</span> kJ<span style="color: #b0c4de;">,</span> cJ<span style="color: #b0c4de;">,</span> gJ<span style="color: #b0c4de;">,</span> h<span style="color: #b0c4de;">,</span> Nt)<span style="color: #b0c4de;">,</span> <span style="color: #b0c4de;">...</span>
<span class="linenr">37: </span>    <span style="color: #ffa07a;">'nldcofs'</span><span style="color: #b0c4de;">,</span> @(w<span style="color: #b0c4de;">,</span>xi) [1 1 <span style="color: #b0c4de;">-</span>1 <span style="color: #b0c4de;">-</span>1]<span style="color: #b0c4de;">,</span> <span style="color: #b0c4de;">...</span> <span style="color: #ff4500;">% The relative displacement.</span>
<span class="linenr">38: </span>    <span style="color: #ffa07a;">'nlfcofs'</span><span style="color: #b0c4de;">,</span> @(w<span style="color: #b0c4de;">,</span>xi) 1<span style="color: #b0c4de;">/</span>(Ey<span style="color: #b0c4de;">*</span>Ar)<span style="color: #b0c4de;">*</span>[1<span style="color: #b0c4de;">;</span> 0])<span style="color: #b0c4de;">;</span>
<span class="linenr">39: </span><span style="color: #ff4500;">%</span><span style="color: #ff4500;">NOTE: The 'nldcofs' specifies the coefficient matrix such that the</span>
<span class="linenr">40: </span><span style="color: #ff4500;">% </span><span style="color: #ff4500;">displacement(s) used as input for the nonlinearity is given as,</span>
<span class="linenr">41: </span><span style="color: #ff4500;">%   </span><span style="color: #ff4500;">u = NLDCOFS * [a;b]         where "a" and "b" are the wave coefficients</span>
<span class="linenr">42: </span><span style="color: #ff4500;">%   </span><span style="color: #ff4500;">of points 'i' and 'j' respectively.</span>
<span class="linenr">43: </span><span style="color: #ff4500;">%</span>
<span class="linenr">44: </span><span style="color: #ff4500;">%      </span><span style="color: #ff4500;">The 'nlfcofs' specifies the coefficient matrix that the results from</span>
<span class="linenr">45: </span><span style="color: #ff4500;">% </span><span style="color: #ff4500;">the nonlinear force function are multiplied with before being added to</span>
<span class="linenr">46: </span><span style="color: #ff4500;">% </span><span style="color: #ff4500;">the equations of motion. The nonlinear forces are added in the LHS of the</span>
<span class="linenr">47: </span><span style="color: #ff4500;">% </span><span style="color: #ff4500;">equations. </span>
</pre>
</div>
<p>
The meaning of the different terms are provided as comments in the code itself.
</p>

<details class="code-details"
                 style ="padding: 1em;
                          background-color: #c9c9c9;
                          /* background-color: pink; */
                          border-radius: 15px;
                          color: hsl(157 75%);
                          font-size: 0.9em;
                          box-shadow: 0.05em 0.1em 5px 0.01em  #00000057;">
                  <summary>
                    <strong>
                      <font face="Courier" size="3" color="black">
                         The [[https://github.com/Nidish96/wavevib/tree/master/EXAMPLES/HDUFF.m][HDUFF]] function
                      </font>
                    </strong>
                  </summary>
<p>
Here is the <a href="https://github.com/Nidish96/wavevib/tree/master/EXAMPLES/HDUFF.m">HDUFF</a> function that takes as input the relative displacment harmonics and returns the force harmonics. 
</p>
<div class="org-src-container">
<pre class="src src-octave"><span style="color: #00ffff;">function</span> [FNL<span style="color: #b0c4de;">,</span> dFNLdU<span style="color: #b0c4de;">,</span> dFNLdw] <span style="color: #b0c4de;">=</span> <span style="color: #87cefa;">HDUFF</span>(Uw<span style="color: #b0c4de;">,</span> kJs<span style="color: #b0c4de;">,</span> cJs<span style="color: #b0c4de;">,</span> gJs<span style="color: #b0c4de;">,</span> h<span style="color: #b0c4de;">,</span> Nt)
<span style="color: #ff4500;">%</span><span style="color: #ff4500;">HDUFF returns the Fourier Coefficients of the cubic spring along with</span>
<span style="color: #ff4500;">%</span><span style="color: #ff4500;">linear connections for given displacement coefficients. Force that is</span>
<span style="color: #ff4500;">%</span><span style="color: #ff4500;">returned is:</span>
<span style="color: #ff4500;">%           </span><span style="color: #ff4500;">kJs * us + cJs * uds + gJs * us.^3</span>
<span style="color: #ff4500;">% </span><span style="color: #ff4500;">When us is a vector of multiple DOFs, the coefficients are</span>
<span style="color: #ff4500;">% </span><span style="color: #ff4500;">appropriately sized matrices.</span>
<span style="color: #ff4500;">%</span>
<span style="color: #ff4500;">%   </span><span style="color: #ff4500;">USAGE: </span>
<span style="color: #ff4500;">%       </span><span style="color: #ff4500;">[FNL, dFNLdU, dFNLdw] = HDUFF(Uw, kJ, cJ, gJ, h, Nt);</span>
<span style="color: #ff4500;">%   </span><span style="color: #ff4500;">INPUTS:</span>
<span style="color: #ff4500;">%       </span><span style="color: #ff4500;">Uw      : (Nd*Nhc+1,1) [Harmonics of DOFs; frequency]</span>
<span style="color: #ff4500;">%       </span><span style="color: #ff4500;">kJ,cJ,gJ: (Nd,Nd) Stiffness, damping and cubic stiffness matrices</span>
<span style="color: #ff4500;">%       </span><span style="color: #ff4500;">h       : (Nh,1) List of harmonics to balance</span>
<span style="color: #ff4500;">%       </span><span style="color: #ff4500;">Nt      : (int) AFT samples</span>
<span style="color: #ff4500;">%   </span><span style="color: #ff4500;">OUTPUTS:</span>
<span style="color: #ff4500;">%       </span><span style="color: #ff4500;">FNL     : (Nd*Nhc,1) Nonlinear force harmonics</span>
<span style="color: #ff4500;">%       </span><span style="color: #ff4500;">dFNLdU  : (Nd*Nhc,Nd*Nhc) Nonlinear force harmonic jacobian</span>
<span style="color: #ff4500;">%       </span><span style="color: #ff4500;">dFNLdw  : (Nd*Nhc,1) Jacobian wrt frequency</span>

    Nhc <span style="color: #b0c4de;">=</span> sum((h<span style="color: #b0c4de;">==</span>0)<span style="color: #b0c4de;">+</span>2<span style="color: #b0c4de;">*</span>(h<span style="color: #b0c4de;">~=</span>0))<span style="color: #b0c4de;">;</span>
    D1 <span style="color: #b0c4de;">=</span> kron(diag(h)<span style="color: #b0c4de;">,</span>[0 1<span style="color: #b0c4de;">;-</span>1 0])<span style="color: #b0c4de;">*</span>Uw(end)<span style="color: #b0c4de;">;</span>  <span style="color: #ff4500;">% Fourier Differentiation mx</span>
    <span style="color: #00ffff;">if</span> h(1)<span style="color: #b0c4de;">==</span>0
        D1 <span style="color: #b0c4de;">=</span> D1(2<span style="color: #b0c4de;">:</span>end<span style="color: #b0c4de;">,</span>2<span style="color: #b0c4de;">:</span>end)<span style="color: #b0c4de;">;</span>
    <span style="color: #00ffff;">end</span>
    Nd <span style="color: #b0c4de;">=</span> length(Uw(1<span style="color: #b0c4de;">:</span>end<span style="color: #b0c4de;">-</span>1))<span style="color: #b0c4de;">/</span>Nhc<span style="color: #b0c4de;">;</span>
    <span style="color: #00ffff;">if</span> rem(Nd<span style="color: #b0c4de;">,</span>1)<span style="color: #b0c4de;">~=</span>0
        error(<span style="color: #ffa07a;">'Nd not an integer. Value is %f .'</span><span style="color: #b0c4de;">,</span> Nd)<span style="color: #b0c4de;">;</span>
    <span style="color: #00ffff;">end</span>
    <span style="color: #00ffff;">if</span> all(size(kJs)<span style="color: #b0c4de;">~=</span>Nd)
        kJs <span style="color: #b0c4de;">=</span> kJs(1)<span style="color: #b0c4de;">*</span>eye(Nd)<span style="color: #b0c4de;">;</span>
    <span style="color: #00ffff;">end</span>
    <span style="color: #00ffff;">if</span> all(size(cJs)<span style="color: #b0c4de;">~=</span>Nd)
        cJs <span style="color: #b0c4de;">=</span> cJs(1)<span style="color: #b0c4de;">*</span>eye(Nd)<span style="color: #b0c4de;">;</span>
    <span style="color: #00ffff;">end</span>
    <span style="color: #00ffff;">if</span> all(size(gJs)<span style="color: #b0c4de;">~=</span>Nd)
        gJs <span style="color: #b0c4de;">=</span> gJs(1)<span style="color: #b0c4de;">*</span>eye(Nd)<span style="color: #b0c4de;">;</span>
    <span style="color: #00ffff;">end</span>

    cst <span style="color: #b0c4de;">=</span> AFT(eye(Nhc)<span style="color: #b0c4de;">,</span> h<span style="color: #b0c4de;">,</span> Nt<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'f2t'</span>)<span style="color: #b0c4de;">;</span>
    sct <span style="color: #b0c4de;">=</span> AFT(D1<span style="color: #b0c4de;">,</span> h<span style="color: #b0c4de;">,</span> Nt<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'f2t'</span>)<span style="color: #b0c4de;">;</span>

    ut <span style="color: #b0c4de;">=</span> AFT(reshape(Uw(1<span style="color: #b0c4de;">:</span>end<span style="color: #b0c4de;">-</span>1)<span style="color: #b0c4de;">,</span> Nd<span style="color: #b0c4de;">,</span> Nhc)<span style="color: #b0c4de;">',</span> h<span style="color: #b0c4de;">,</span> Nt<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'f2t'</span>)<span style="color: #b0c4de;">;</span>
    udt <span style="color: #b0c4de;">=</span> AFT(D1<span style="color: #b0c4de;">*</span>reshape(Uw(1<span style="color: #b0c4de;">:</span>end<span style="color: #b0c4de;">-</span>1)<span style="color: #b0c4de;">,</span> Nd<span style="color: #b0c4de;">,</span> Nhc)<span style="color: #b0c4de;">',</span> h<span style="color: #b0c4de;">,</span> Nt<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'f2t'</span>)<span style="color: #b0c4de;">;</span>

    ft <span style="color: #b0c4de;">=</span> ut<span style="color: #b0c4de;">*</span>kJs<span style="color: #b0c4de;">'</span> <span style="color: #b0c4de;">+</span> udt<span style="color: #b0c4de;">*</span>cJs<span style="color: #b0c4de;">'</span> <span style="color: #b0c4de;">+</span> ut<span style="color: #b0c4de;">.^</span>3<span style="color: #b0c4de;">*</span>gJs<span style="color: #b0c4de;">';</span>
    dfdu <span style="color: #b0c4de;">=</span> kron(ones(Nt<span style="color: #b0c4de;">,</span>1)<span style="color: #b0c4de;">,</span> kJs<span style="color: #b0c4de;">'</span>)<span style="color: #b0c4de;">;</span>
    <span style="color: #00ffff;">for</span> di<span style="color: #b0c4de;">=</span>1<span style="color: #b0c4de;">:</span>Nd
        dfdu(di<span style="color: #b0c4de;">:</span>Nd<span style="color: #b0c4de;">:</span>end<span style="color: #b0c4de;">,:</span>) <span style="color: #b0c4de;">=</span> dfdu(di<span style="color: #b0c4de;">:</span>Nd<span style="color: #b0c4de;">:</span>end<span style="color: #b0c4de;">,:</span>)<span style="color: #b0c4de;">+</span>3<span style="color: #b0c4de;">*</span>ut(<span style="color: #b0c4de;">:,</span>di)<span style="color: #b0c4de;">.^</span>2<span style="color: #b0c4de;">.*</span>gJs(<span style="color: #b0c4de;">:,</span>di)<span style="color: #b0c4de;">';</span>
    <span style="color: #00ffff;">end</span>
    dfdud <span style="color: #b0c4de;">=</span> kron(ones(Nt<span style="color: #b0c4de;">,</span>1)<span style="color: #b0c4de;">,</span> cJs<span style="color: #b0c4de;">'</span>)<span style="color: #b0c4de;">;</span>

    FNL <span style="color: #b0c4de;">=</span> reshape(AFT(ft<span style="color: #b0c4de;">,</span> h<span style="color: #b0c4de;">,</span> Nt<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'t2f'</span>)<span style="color: #b0c4de;">',</span> Nd<span style="color: #b0c4de;">*</span>Nhc<span style="color: #b0c4de;">,</span>1)<span style="color: #b0c4de;">;</span>
    dFNLdU <span style="color: #b0c4de;">=</span> zeros(Nhc<span style="color: #b0c4de;">*</span>Nd)<span style="color: #b0c4de;">;</span>
    dFNLdw <span style="color: #b0c4de;">=</span> zeros(Nhc<span style="color: #b0c4de;">*</span>Nd<span style="color: #b0c4de;">,</span>1)<span style="color: #b0c4de;">;</span>
    <span style="color: #00ffff;">for</span> di<span style="color: #b0c4de;">=</span>1<span style="color: #b0c4de;">:</span>Nd
        <span style="color: #00ffff;">for</span> dj<span style="color: #b0c4de;">=</span>1<span style="color: #b0c4de;">:</span>Nd
            dFNLdU(di<span style="color: #b0c4de;">:</span>Nd<span style="color: #b0c4de;">:</span>end<span style="color: #b0c4de;">,</span> dj<span style="color: #b0c4de;">:</span>Nd<span style="color: #b0c4de;">:</span>end) <span style="color: #b0c4de;">=</span> <span style="color: #b0c4de;">...</span>
                AFT(dfdu(dj<span style="color: #b0c4de;">:</span>Nd<span style="color: #b0c4de;">:</span>end<span style="color: #b0c4de;">,</span> di)<span style="color: #b0c4de;">.*</span>cst <span style="color: #b0c4de;">+</span> dfdud(dj<span style="color: #b0c4de;">:</span>Nd<span style="color: #b0c4de;">:</span>end<span style="color: #b0c4de;">,</span> di)<span style="color: #b0c4de;">.*</span>sct<span style="color: #b0c4de;">,</span> h<span style="color: #b0c4de;">,</span> Nt<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'t2f'</span>)<span style="color: #b0c4de;">;</span>
        <span style="color: #00ffff;">end</span>
        dFNLdw(di<span style="color: #b0c4de;">:</span>Nd<span style="color: #b0c4de;">:</span>end) <span style="color: #b0c4de;">=</span> AFT(sum(reshape(dfdud(<span style="color: #b0c4de;">:,</span> di)<span style="color: #b0c4de;">,</span> Nd<span style="color: #b0c4de;">,</span> Nt)<span style="color: #b0c4de;">'.*</span>udt<span style="color: #b0c4de;">/</span>Uw(end)<span style="color: #b0c4de;">,</span>2)<span style="color: #b0c4de;">,</span> h<span style="color: #b0c4de;">,</span> Nt<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'t2f'</span>)<span style="color: #b0c4de;">;</span>
    <span style="color: #00ffff;">end</span>

<span style="color: #ff4500;">%     </span><span style="color: #ff4500;">% Simple (SDOF) Version</span>
<span style="color: #ff4500;">%     </span><span style="color: #ff4500;">ut = AFT(Uw(1:end-1), Nt, h, 'f2t');</span>
<span style="color: #ff4500;">%     </span><span style="color: #ff4500;">udt = AFT(D1*Uw(1:end-1), Nt, h, 'f2t');</span>
<span style="color: #ff4500;">% </span>
<span style="color: #ff4500;">%     </span><span style="color: #ff4500;">ft = kJs*ut + cJs*udt + gJs*ut.^3;</span>
<span style="color: #ff4500;">%     </span><span style="color: #ff4500;">dfdu = kJs + 3*gJs*ut.^2;</span>
<span style="color: #ff4500;">%     </span><span style="color: #ff4500;">dfdud = cJs*ones(Nt,1);</span>
<span style="color: #ff4500;">% </span>
<span style="color: #ff4500;">%     </span><span style="color: #ff4500;">FNL = AFT(ft, Nt, h, 't2f');</span>
<span style="color: #ff4500;">%     </span><span style="color: #ff4500;">dFNLdU = AFT(dfdu.*cst + dfdud.*sct, Nt, h, 't2f');</span>
<span style="color: #ff4500;">%     </span><span style="color: #ff4500;">dFNLdw = AFT(dfdud.*udt/Uw(end), Nt, h, 't2f');</span>
<span style="color: #00ffff;">end</span>
</pre>
</div>


</details>


</details>

<details class="code-details"
                 style ="padding: 1em;
                          background-color: #c9c9c9;
                          /* background-color: pink; */
                          border-radius: 15px;
                          color: hsl(157 75%);
                          font-size: 0.9em;
                          box-shadow: 0.05em 0.1em 5px 0.01em  #00000057;">
                  <summary>
                    <strong>
                      <font face="Courier" size="3" color="black">
                         Conduct Preprocessing
                      </font>
                    </strong>
                  </summary>
<p>
Preprocess everything (same as before).
</p>
<div class="org-src-container">
<pre class="src src-octave"><span class="linenr">48: </span><span style="color: #ff4500;">%% </span><span style="color: #ff4500;">Preprocess Everything</span>
<span class="linenr">49: </span>[pcs<span style="color: #b0c4de;">,</span> bcs<span style="color: #b0c4de;">,</span> joints<span style="color: #b0c4de;">,</span> excs<span style="color: #b0c4de;">,</span> Klib] <span style="color: #b0c4de;">=</span> WBPREPROC(pcs<span style="color: #b0c4de;">,</span> bcs<span style="color: #b0c4de;">,</span> joints<span style="color: #b0c4de;">,</span> excs<span style="color: #b0c4de;">,</span> Klib)<span style="color: #b0c4de;">;</span>
<span class="linenr">50: </span>Nwc <span style="color: #b0c4de;">=</span> size(wcomps<span style="color: #b0c4de;">,</span>1)<span style="color: #b0c4de;">;</span>  <span style="color: #ff4500;">% Number of wave components</span>
</pre>
</div>


</details>
<details class="code-details"
                 style ="padding: 1em;
                          background-color: white;
                          /* background-color: pink; */
                          border-radius: 15px;
                          color: hsl(157 75%);
                          font-size: 0.9em;
                          box-shadow: 0.05em 0.1em 5px 0.01em  #00000057;">
                  <summary>
                    <strong>
                      <font face="Courier" size="3" color="black">
                         Setup the Continuation Parameters for the Nonlinear Forced Response Analysis
                      </font>
                    </strong>
                  </summary>
<div class="org-src-container">
<pre class="src src-octave"><span class="linenr">51: </span>Npts <span style="color: #b0c4de;">=</span> pcs(end).irange(end)<span style="color: #b0c4de;">;</span>  <span style="color: #ff4500;">% Number of points in model</span>
<span class="linenr">52: </span>Nh <span style="color: #b0c4de;">=</span> length(h)<span style="color: #b0c4de;">;</span> <span style="color: #ff4500;">% Number of harmonics</span>
<span class="linenr">53: </span>Nhc <span style="color: #b0c4de;">=</span> sum((h<span style="color: #b0c4de;">==</span>0)<span style="color: #b0c4de;">+</span>2<span style="color: #b0c4de;">*</span>(h<span style="color: #b0c4de;">~=</span>0))<span style="color: #b0c4de;">;</span>  <span style="color: #ff4500;">% Number of harmonic coefficients</span>
<span class="linenr">54: </span><span style="color: #ff4500;">% </span><span style="color: #ff4500;">Compute indices to convert between real-imaginary and complex</span>
<span class="linenr">55: </span><span style="color: #ff4500;">% </span><span style="color: #ff4500;">representations:</span>
<span class="linenr">56: </span>[zinds<span style="color: #b0c4de;">,</span>hinds<span style="color: #b0c4de;">,</span>rinds0<span style="color: #b0c4de;">,</span>rinds<span style="color: #b0c4de;">,</span>iinds] <span style="color: #b0c4de;">=</span> HINDS(Npts<span style="color: #b0c4de;">*</span>Nwc<span style="color: #b0c4de;">,</span> h)<span style="color: #b0c4de;">;</span>
<span class="linenr">57: </span>
<span class="linenr">58: </span><span style="color: #ff4500;">% </span><span style="color: #ff4500;">Setup continuation limits</span>
<span class="linenr">59: </span>Wst <span style="color: #b0c4de;">=</span> 78e3<span style="color: #b0c4de;">;</span>
<span class="linenr">60: </span>Wen <span style="color: #b0c4de;">=</span> 82e3<span style="color: #b0c4de;">;</span>
<span class="linenr">61: </span>dw  <span style="color: #b0c4de;">=</span> 0.025<span style="color: #b0c4de;">;</span>  <span style="color: #ff4500;">% Continuation step size</span>
<span class="linenr">62: </span>
<span class="linenr">63: </span><span style="color: #ff4500;">% </span><span style="color: #ff4500;">Continuation properties for CONTINUE.m</span>
<span class="linenr">64: </span>Copt <span style="color: #b0c4de;">=</span> struct(<span style="color: #ffa07a;">'Nmax'</span><span style="color: #b0c4de;">,</span> 100<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'angopt'</span><span style="color: #b0c4de;">,</span> 2e<span style="color: #b0c4de;">-</span>1<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'DynDscale'</span><span style="color: #b0c4de;">,</span> 1)<span style="color: #b0c4de;">;</span>
<span class="linenr">65: </span>
<span class="linenr">66: </span>Famps <span style="color: #b0c4de;">=</span> 150e5<span style="color: #b0c4de;">*</span>[0.5 1 2]<span style="color: #b0c4de;">;</span>  <span style="color: #ff4500;">% List of force values to conduct analysis for</span>
<span class="linenr">67: </span>acC <span style="color: #b0c4de;">=</span> cell(size(Famps))<span style="color: #b0c4de;">;</span>  <span style="color: #ff4500;">% Cell to store results</span>
</pre>
</div>


</details>
<details class="code-details"
                 style ="padding: 1em;
                          background-color: #c9c9c9;
                          /* background-color: pink; */
                          border-radius: 15px;
                          color: hsl(157 75%);
                          font-size: 0.9em;
                          box-shadow: 0.05em 0.1em 5px 0.01em  #00000057;">
                  <summary>
                    <strong>
                      <font face="Courier" size="3" color="black">
                         Do the forced response analysis
                      </font>
                    </strong>
                  </summary>
<p>
Loop over the desired force amplitudes and do the continuation analysis.
</p>
<div class="org-src-container">
<pre class="src src-octave"><span class="linenr">68: </span><span style="color: #00ffff;">for</span> fi<span style="color: #b0c4de;">=</span>1<span style="color: #b0c4de;">:</span>length(Famps)
<span class="linenr">69: </span>    <span style="color: #ff4500;">% Continuation is done in real-imaginary representation</span>
<span class="linenr">70: </span>    ari0 <span style="color: #b0c4de;">=</span> zeros(Npts<span style="color: #b0c4de;">*</span>Nwc<span style="color: #b0c4de;">*</span>Nhc<span style="color: #b0c4de;">,</span> 1)<span style="color: #b0c4de;">;</span>
<span class="linenr">71: </span>    ariwC <span style="color: #b0c4de;">=</span> CONTINUE(@(ariw) WVHBRESFUN(ariw<span style="color: #b0c4de;">,</span> Famps(fi)<span style="color: #b0c4de;">,</span> h<span style="color: #b0c4de;">,</span> pcs<span style="color: #b0c4de;">,</span> bcs<span style="color: #b0c4de;">,</span> joints<span style="color: #b0c4de;">,</span> Klib)<span style="color: #b0c4de;">,</span> <span style="color: #b0c4de;">...</span>
<span class="linenr">72: </span>        ari0<span style="color: #b0c4de;">,</span> Wst<span style="color: #b0c4de;">,</span> Wen<span style="color: #b0c4de;">,</span> dw<span style="color: #b0c4de;">,</span> Copt)<span style="color: #b0c4de;">;</span>
<span class="linenr">73: </span>
<span class="linenr">74: </span>    <span style="color: #ff4500;">% Convert to complex representation</span>
<span class="linenr">75: </span>    acC{fi} <span style="color: #b0c4de;">=</span> zeros(Npts<span style="color: #b0c4de;">*</span>Nwc<span style="color: #b0c4de;">*</span>Nh<span style="color: #b0c4de;">+</span>1<span style="color: #b0c4de;">,</span> size(ariwC<span style="color: #b0c4de;">,</span>2))<span style="color: #b0c4de;">;</span>
<span class="linenr">76: </span>    acC{fi}([zinds hinds end]<span style="color: #b0c4de;">,</span> <span style="color: #b0c4de;">:</span>) <span style="color: #b0c4de;">=</span> [ariwC(rinds0<span style="color: #b0c4de;">,:</span>)<span style="color: #b0c4de;">;</span> ariwC(rinds<span style="color: #b0c4de;">,:</span>)<span style="color: #b0c4de;">+</span>1j<span style="color: #b0c4de;">*</span>ariwC(iinds<span style="color: #b0c4de;">,:</span>)<span style="color: #b0c4de;">;</span>ariwC(end<span style="color: #b0c4de;">,:</span>)]<span style="color: #b0c4de;">;</span>
<span class="linenr">77: </span><span style="color: #00ffff;">end</span>
</pre>
</div>


</details>
<details class="code-details"
                 style ="padding: 1em;
                          background-color: white;
                          /* background-color: pink; */
                          border-radius: 15px;
                          color: hsl(157 75%);
                          font-size: 0.9em;
                          box-shadow: 0.05em 0.1em 5px 0.01em  #00000057;">
                  <summary>
                    <strong>
                      <font face="Courier" size="3" color="black">
                         Plot the forced response
                      </font>
                    </strong>
                  </summary>
<p>
Now plot the forced response (similar to sec. <a href="#org25352c7">3.2</a>) at the point right after the joint.
</p>
<div class="org-src-container">
<pre class="src src-octave"><span class="linenr">78: </span>opi <span style="color: #b0c4de;">=</span>  9<span style="color: #b0c4de;">:</span>10<span style="color: #b0c4de;">;</span>
<span class="linenr">79: </span>figure(2)
<span class="linenr">80: </span>clf()
<span class="linenr">81: </span><span style="color: #00ffff;">for</span> fi<span style="color: #b0c4de;">=</span>1<span style="color: #b0c4de;">:</span>length(Famps)
<span class="linenr">82: </span>    subplot(2<span style="color: #b0c4de;">,</span>1<span style="color: #b0c4de;">,</span>1)
<span class="linenr">83: </span>    aa(fi)<span style="color: #b0c4de;">=</span>plot(acC{fi}(end<span style="color: #b0c4de;">,:</span>)<span style="color: #b0c4de;">/</span>1e3<span style="color: #b0c4de;">,</span> abs(2<span style="color: #b0c4de;">*</span>sum(acC{fi}(opi<span style="color: #b0c4de;">,:</span>)))<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'LineWidth'</span><span style="color: #b0c4de;">,</span> 2)<span style="color: #b0c4de;">;</span> hold on
<span class="linenr">84: </span>    legend(aa(fi)<span style="color: #b0c4de;">,</span> sprintf(<span style="color: #ffa07a;">'F = %.1f MN'</span><span style="color: #b0c4de;">,</span> Famps(fi)<span style="color: #b0c4de;">*</span>1e<span style="color: #b0c4de;">-</span>6))
<span class="linenr">85: </span>    ylabel(<span style="color: #ffa07a;">'Response (m)'</span>)
<span class="linenr">86: </span>    subplot(2<span style="color: #b0c4de;">,</span>1<span style="color: #b0c4de;">,</span>2)
<span class="linenr">87: </span>    plot(acC{fi}(end<span style="color: #b0c4de;">,:</span>)<span style="color: #b0c4de;">/</span>1e3<span style="color: #b0c4de;">,</span> rad2deg(angle(2<span style="color: #b0c4de;">*</span>sum(acC{fi}(opi<span style="color: #b0c4de;">,:</span>))))<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'LineWidth'</span><span style="color: #b0c4de;">,</span> 2)<span style="color: #b0c4de;">;</span> hold on
<span class="linenr">88: </span>    ylabel(<span style="color: #ffa07a;">'Phase (degs)'</span>)
<span class="linenr">89: </span><span style="color: #00ffff;">end</span>
<span class="linenr">90: </span><span style="color: #00ffff;">for</span> i<span style="color: #b0c4de;">=</span>1<span style="color: #b0c4de;">:</span>2
<span class="linenr">91: </span>    subplot(2<span style="color: #b0c4de;">,</span>1<span style="color: #b0c4de;">,</span>i)
<span class="linenr">92: </span>    xlim([79 82])<span style="color: #b0c4de;">;</span> grid on
<span class="linenr">93: </span><span style="color: #00ffff;">end</span>
<span class="linenr">94: </span>set(gca<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'YTick'</span><span style="color: #b0c4de;">,</span> <span style="color: #b0c4de;">-</span>180<span style="color: #b0c4de;">:</span>90<span style="color: #b0c4de;">:</span>180)
<span class="linenr">95: </span>xlabel(<span style="color: #ffa07a;">'Frequency (k rad/s)'</span>)
<span class="linenr">96: </span>subplot(2<span style="color: #b0c4de;">,</span>1<span style="color: #b0c4de;">,</span>1)
<span class="linenr">97: </span>legend(aa<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'Location'</span><span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'northwest'</span>)
</pre>
</div>


</details>
</div>
</div>
<div id="outline-container-orga938ceb" class="outline-4">
<h4 id="orga938ceb"><span class="section-number-4">3.3.2.</span> Results</h4>
<div class="outline-text-4" id="text-3-3-2">
<p>
Fig. <a href="#org5944732">4</a> presents the forced response for this example. It shows the classical coexisting solutions behavior for cubically stiff systems as well as an amplitude-dependent nonlinear behavior.
</p>

<div id="org5944732" class="figure">
<p><img src="./FIGS/c_out.png" alt="c_out.png" width="600px" />
</p>
<p><span class="figure-number">Figure 4: </span>Nonlinear forced response of the jointed bar.</p>
</div>
</div>
</div>
<div id="outline-container-org5281059" class="outline-4">
<h4 id="org5281059"><span class="section-number-4">3.3.3.</span> <span class="todo TODO">TODO</span> Include a nice schematic diagram</h4>
</div>
<div id="outline-container-orgcaf0ba5" class="outline-4">
<h4 id="orgcaf0ba5"><span class="section-number-4">3.3.4.</span> <span class="todo TODO">TODO</span> Describe how to use WVEVALWCOFS for evaluating wave coefficients and plot deflection shape.</h4>
</div>
</div>
<div id="outline-container-org860f8f0" class="outline-3">
<h3 id="org860f8f0"><span class="section-number-3">3.4.</span> Nonlinear-Jointed Euler-Bernoulli Beams</h3>
<div class="outline-text-3" id="text-3-4">
<p>
<a id="orgf9856d7"></a>
This is a nonlinear jointed Euler-Bernoulli beams example. The reason for including this is to show how to handle evanescent wave components (non-traveling wave components).
</p>
</div>
<div id="outline-container-org747e9ce" class="outline-4">
<h4 id="org747e9ce"><span class="section-number-4">3.4.1.</span> Code Overview</h4>
<div class="outline-text-4" id="text-3-4-1">
<details class="code-details"
                 style ="padding: 1em;
                          background-color: #c9c9c9;
                          /* background-color: pink; */
                          border-radius: 15px;
                          color: hsl(157 75%);
                          font-size: 0.9em;
                          box-shadow: 0.05em 0.1em 5px 0.01em  #00000057;">
                  <summary>
                    <strong>
                      <font face="Courier" size="3" color="black">
                         Setup the model
                      </font>
                    </strong>
                  </summary>
<p>
The model setup is very similar to the example in sec. <a href="#org7fe6f82">3.3</a>, but adapted for the Euler-Bernoulli Beam context.
</p>
<div class="org-src-container">
<pre class="src src-octave"><span class="linenr"> 1: </span>addpath(<span style="color: #ffa07a;">'../ROUTINES/SOLVERS/'</span>)
<span class="linenr"> 2: </span>addpath(<span style="color: #ffa07a;">'../ROUTINES/WBM/'</span>)
<span class="linenr"> 3: </span>
<span class="linenr"> 4: </span><span style="color: #ff4500;">%</span><span style="color: #ff4500;">DESCRIPTION: This is a nonlinear jointed Euler-Bernoulli Beam example</span>
<span class="linenr"> 5: </span><span style="color: #ff4500;">%</span><span style="color: #ff4500;">similar to the jointed bar example.</span>
<span class="linenr"> 6: </span>
<span class="linenr"> 7: </span><span style="color: #ff4500;">%% </span><span style="color: #ff4500;">Setup Model</span>
<span class="linenr"> 8: </span>Ey <span style="color: #b0c4de;">=</span> 190e9<span style="color: #b0c4de;">;</span>
<span class="linenr"> 9: </span>rho <span style="color: #b0c4de;">=</span> 7680<span style="color: #b0c4de;">;</span>
<span class="linenr">10: </span>wid <span style="color: #b0c4de;">=</span> 0.2<span style="color: #b0c4de;">;</span>  <span style="color: #ff4500;">% Width</span>
<span class="linenr">11: </span>brd <span style="color: #b0c4de;">=</span> 0.4<span style="color: #b0c4de;">;</span>  <span style="color: #ff4500;">% Breadth</span>
<span class="linenr">12: </span>Ar <span style="color: #b0c4de;">=</span> wid<span style="color: #b0c4de;">*</span>brd<span style="color: #b0c4de;">;</span>  <span style="color: #ff4500;">% Area</span>
<span class="linenr">13: </span>Iy <span style="color: #b0c4de;">=</span> wid<span style="color: #b0c4de;">^</span>3<span style="color: #b0c4de;">*</span>brd<span style="color: #b0c4de;">/</span>12<span style="color: #b0c4de;">;</span>  <span style="color: #ff4500;">% 2nd moment of area</span>
<span class="linenr">14: </span>L0 <span style="color: #b0c4de;">=</span> 2.0<span style="color: #b0c4de;">;</span>  <span style="color: #ff4500;">% Total Length</span>
<span class="linenr">15: </span>Klib <span style="color: #b0c4de;">=</span> struct(<span style="color: #ffa07a;">'K'</span><span style="color: #b0c4de;">,</span> @(w<span style="color: #b0c4de;">,</span>xi) sqrt(w)<span style="color: #b0c4de;">*</span>(rho<span style="color: #b0c4de;">*</span>Ar<span style="color: #b0c4de;">/</span>Ey<span style="color: #b0c4de;">/</span>Iy)<span style="color: #b0c4de;">^</span>(0.25))<span style="color: #b0c4de;">;</span>
<span class="linenr">16: </span>wcomps <span style="color: #b0c4de;">=</span> [1 1<span style="color: #b0c4de;">;</span>  <span style="color: #ff4500;">% First component -&gt; exp(  k x )</span>
<span class="linenr">17: </span>                                        <span style="color: #b0c4de;">-</span>1 1<span style="color: #b0c4de;">;</span>  <span style="color: #ff4500;">% Second component-&gt; exp( -k x )</span>
<span class="linenr">18: </span>                                        1j 1<span style="color: #b0c4de;">;</span>  <span style="color: #ff4500;">% Third component -&gt; exp( ik x )</span>
<span class="linenr">19: </span>                                        <span style="color: #b0c4de;">-</span>1j 1]<span style="color: #b0c4de;">;</span> <span style="color: #ff4500;">% Fourth component-&gt; exp(-ik x )</span>
<span class="linenr">20: </span>
<span class="linenr">21: </span><span style="color: #ff4500;">% </span><span style="color: #ff4500;">Setup "wave-based pieces"</span>
<span class="linenr">22: </span>pcs <span style="color: #b0c4de;">=</span> [struct(<span style="color: #ffa07a;">'coords'</span><span style="color: #b0c4de;">,</span> [0<span style="color: #b0c4de;">;</span>L0<span style="color: #b0c4de;">/</span>3<span style="color: #b0c4de;">;</span>L0]<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'wcomps'</span><span style="color: #b0c4de;">,</span> wcomps)<span style="color: #b0c4de;">;</span>
<span class="linenr">23: </span>       struct(<span style="color: #ffa07a;">'coords'</span><span style="color: #b0c4de;">,</span> [L0<span style="color: #b0c4de;">;</span>2<span style="color: #b0c4de;">*</span>L0]<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'wcomps'</span><span style="color: #b0c4de;">,</span> wcomps)]<span style="color: #b0c4de;">;</span>
<span class="linenr">24: </span>
<span class="linenr">25: </span><span style="color: #ff4500;">% </span><span style="color: #ff4500;">Setup Boundary Conditions. Fix-Fix used here.</span>
<span class="linenr">26: </span>bcs <span style="color: #b0c4de;">=</span> [struct(<span style="color: #ffa07a;">'i'</span><span style="color: #b0c4de;">,</span> 1<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'cofs'</span><span style="color: #b0c4de;">,</span> @(w<span style="color: #b0c4de;">,</span>xi) [1 1 1 1<span style="color: #b0c4de;">;</span> 1 <span style="color: #b0c4de;">-</span>1 1j <span style="color: #b0c4de;">-</span>1j])<span style="color: #b0c4de;">;</span>
<span class="linenr">27: </span>                         struct(<span style="color: #ffa07a;">'i'</span><span style="color: #b0c4de;">,</span> 5<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'cofs'</span><span style="color: #b0c4de;">,</span> @(w<span style="color: #b0c4de;">,</span>xi) [1 1 1 1<span style="color: #b0c4de;">;</span> 1 <span style="color: #b0c4de;">-</span>1 1j <span style="color: #b0c4de;">-</span>1j])]<span style="color: #b0c4de;">;</span>
<span class="linenr">28: </span>
<span class="linenr">29: </span><span style="color: #ff4500;">%% </span><span style="color: #ff4500;">Setup Excitation</span>
<span class="linenr">30: </span>Mx <span style="color: #b0c4de;">=</span> @(w<span style="color: #b0c4de;">,</span>xi) inv([Ey<span style="color: #b0c4de;">*</span>Iy<span style="color: #b0c4de;">*</span>Klib.K(w<span style="color: #b0c4de;">,</span>xi)<span style="color: #b0c4de;">^</span>3<span style="color: #b0c4de;">*</span>[<span style="color: #b0c4de;">-</span>1 1 1j <span style="color: #b0c4de;">-</span>1j]<span style="color: #b0c4de;">;</span>
<span class="linenr">31: </span>                                                                        Ey<span style="color: #b0c4de;">*</span>Iy<span style="color: #b0c4de;">*</span>Klib.K(w<span style="color: #b0c4de;">,</span>xi)<span style="color: #b0c4de;">^</span>2<span style="color: #b0c4de;">*</span>[<span style="color: #b0c4de;">-</span>1 <span style="color: #b0c4de;">-</span>1 1 1]<span style="color: #b0c4de;">;</span>
<span class="linenr">32: </span>                                                                        [1 1 1 1]<span style="color: #b0c4de;">;</span>
<span class="linenr">33: </span>                                                                        Klib.K(w<span style="color: #b0c4de;">,</span>xi)<span style="color: #b0c4de;">*</span>[1 <span style="color: #b0c4de;">-</span>1 1j <span style="color: #b0c4de;">-</span>1j]])<span style="color: #b0c4de;">;</span>
<span class="linenr">34: </span>
<span class="linenr">35: </span>excs <span style="color: #b0c4de;">=</span> struct(<span style="color: #ffa07a;">'i'</span><span style="color: #b0c4de;">,</span> 2<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'nh'</span><span style="color: #b0c4de;">,</span> 1<span style="color: #b0c4de;">,</span> <span style="color: #b0c4de;">...</span>
<span class="linenr">36: </span>                                                        <span style="color: #ffa07a;">'rcofs'</span><span style="color: #b0c4de;">,</span> @(w<span style="color: #b0c4de;">,</span>xi) Mx(w<span style="color: #b0c4de;">,</span>xi)<span style="color: #b0c4de;">*</span>[1<span style="color: #b0c4de;">/</span>2<span style="color: #b0c4de;">;</span>0<span style="color: #b0c4de;">;</span>0<span style="color: #b0c4de;">;</span>0])<span style="color: #b0c4de;">;</span>
<span class="linenr">37: </span><span style="color: #ff4500;">%</span><span style="color: #ff4500;">'nh' sets the harmonic at which to apply the excitation</span>
</pre>
</div>
<p>
Make note of how differently the <code>wcomps</code> matrix is setup here to accommodate for four different wave components at each point in the model. Also observe the boundary conditions (through <code>bcs</code>) and the excitation setup.
</p>


</details>
<details class="code-details"
                 style ="padding: 1em;
                          background-color: white;
                          /* background-color: pink; */
                          border-radius: 15px;
                          color: hsl(157 75%);
                          font-size: 0.9em;
                          box-shadow: 0.05em 0.1em 5px 0.01em  #00000057;">
                  <summary>
                    <strong>
                      <font face="Courier" size="3" color="black">
                         Setup the nonlinear joint after setting the AFT properties
                      </font>
                    </strong>
                  </summary>
<p>
The joint setup is quite similar to before but with the key difference that this now requires the beam theory equations. The joint is also taken to connect the beams through both shear as well as moment reactions (with identical coefficients), except for the nonlinearity (which is only acting on the shear). 
</p>
<div class="org-src-container">
<pre class="src src-octave"><span class="linenr">38: </span><span style="color: #ff4500;">%% </span><span style="color: #ff4500;">Setup Joint</span>
<span class="linenr">39: </span>h <span style="color: #b0c4de;">=</span> [1<span style="color: #b0c4de;">;</span> 3]<span style="color: #b0c4de;">;</span>
<span class="linenr">40: </span>Nt <span style="color: #b0c4de;">=</span> 128<span style="color: #b0c4de;">;</span>
<span class="linenr">41: </span>
<span class="linenr">42: </span>kJs <span style="color: #b0c4de;">=</span> diag([1e9 1e9])<span style="color: #b0c4de;">;</span>
<span class="linenr">43: </span>cJs <span style="color: #b0c4de;">=</span> diag([320 320])<span style="color: #b0c4de;">;</span>
<span class="linenr">44: </span>gJs <span style="color: #b0c4de;">=</span> diag([1e8 0])<span style="color: #b0c4de;">;</span>
<span class="linenr">45: </span>cofs <span style="color: #b0c4de;">=</span> @(w<span style="color: #b0c4de;">,</span>xi) [<span style="color: #b0c4de;">-</span>Klib.K(w<span style="color: #b0c4de;">,</span>xi)<span style="color: #b0c4de;">*</span>[1 <span style="color: #b0c4de;">-</span>1 <span style="color: #b0c4de;">-</span>1j 1j 0 0 0 0]<span style="color: #b0c4de;">;</span>
<span class="linenr">46: </span>    <span style="color: #b0c4de;">-</span>[1 1 <span style="color: #b0c4de;">-</span>1 <span style="color: #b0c4de;">-</span>1 0 0 0 0]<span style="color: #b0c4de;">;</span>
<span class="linenr">47: </span>    <span style="color: #b0c4de;">-</span>Klib.K(w<span style="color: #b0c4de;">,</span>xi)<span style="color: #b0c4de;">*</span>[1 <span style="color: #b0c4de;">-</span>1 <span style="color: #b0c4de;">-</span>1j 1j <span style="color: #b0c4de;">-</span>1 1 1j <span style="color: #b0c4de;">-</span>1j]<span style="color: #b0c4de;">;</span>
<span class="linenr">48: </span>    <span style="color: #b0c4de;">-</span>[1 1 <span style="color: #b0c4de;">-</span>1 <span style="color: #b0c4de;">-</span>1 <span style="color: #b0c4de;">-</span>1 <span style="color: #b0c4de;">-</span>1 1 1]]<span style="color: #b0c4de;">;</span>
<span class="linenr">49: </span>joints <span style="color: #b0c4de;">=</span> struct(<span style="color: #ffa07a;">'type'</span><span style="color: #b0c4de;">,</span> 2<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'i'</span><span style="color: #b0c4de;">,</span> 3<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'j'</span><span style="color: #b0c4de;">,</span> 4<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'cofs'</span><span style="color: #b0c4de;">,</span> cofs<span style="color: #b0c4de;">,</span> <span style="color: #b0c4de;">...</span>
<span class="linenr">50: </span>    <span style="color: #ffa07a;">'nl'</span><span style="color: #b0c4de;">,</span> @(Uw) HDUFF(Uw<span style="color: #b0c4de;">,</span> kJs<span style="color: #b0c4de;">,</span> cJs<span style="color: #b0c4de;">,</span> gJs<span style="color: #b0c4de;">,</span> h<span style="color: #b0c4de;">,</span> Nt)<span style="color: #b0c4de;">,</span> <span style="color: #b0c4de;">...</span>
<span class="linenr">51: </span>    <span style="color: #ffa07a;">'nldcofs'</span><span style="color: #b0c4de;">,</span> @(w<span style="color: #b0c4de;">,</span>xi) [1 1 1 1 <span style="color: #b0c4de;">-</span>1 <span style="color: #b0c4de;">-</span>1 <span style="color: #b0c4de;">-</span>1 <span style="color: #b0c4de;">-</span>1<span style="color: #b0c4de;">;</span> Klib.K(w<span style="color: #b0c4de;">,</span>xi)<span style="color: #b0c4de;">*</span>[1 <span style="color: #b0c4de;">-</span>1 1j <span style="color: #b0c4de;">-</span>1j <span style="color: #b0c4de;">-</span>1 1 <span style="color: #b0c4de;">-</span>1j 1j]]<span style="color: #b0c4de;">,</span> <span style="color: #b0c4de;">...</span>
<span class="linenr">52: </span>    <span style="color: #ffa07a;">'nlfcofs'</span><span style="color: #b0c4de;">,</span> @(w<span style="color: #b0c4de;">,</span>xi) [eye(2)<span style="color: #b0c4de;">;</span>zeros(2)]<span style="color: #b0c4de;">/</span>(Ey<span style="color: #b0c4de;">*</span>Iy<span style="color: #b0c4de;">*</span>Klib.K(w<span style="color: #b0c4de;">,</span>xi)<span style="color: #b0c4de;">^</span>2))<span style="color: #b0c4de;">;</span>
<span class="linenr">53: </span><span style="color: #ff4500;">%</span><span style="color: #ff4500;">NOTE: This is a joint that engages both the transverse displacement as</span>
<span class="linenr">54: </span><span style="color: #ff4500;">%</span><span style="color: #ff4500;">well as rotation such that,</span>
<span class="linenr">55: </span><span style="color: #ff4500;">%       </span><span style="color: #ff4500;">fnl = kJs [u;th] + cJs [udot;thdot] + gJs [u^3;th^3];</span>
<span class="linenr">56: </span><span style="color: #ff4500;">%   </span><span style="color: #ff4500;">represents the nonlinear force. "th" in the above is the rotation.</span>
</pre>
</div>
<p>
The nonlinearity is realized by the same <a href="https://github.com/Nidish96/wavevib/tree/master/EXAMPLES/HDUFF.m">HDUFF</a> routine as used in sec. <a href="#org7fe6f82">3.3</a>.
</p>


</details>
<details class="code-details"
                 style ="padding: 1em;
                          background-color: #c9c9c9;
                          /* background-color: pink; */
                          border-radius: 15px;
                          color: hsl(157 75%);
                          font-size: 0.9em;
                          box-shadow: 0.05em 0.1em 5px 0.01em  #00000057;">
                  <summary>
                    <strong>
                      <font face="Courier" size="3" color="black">
                         Preprocess the model
                      </font>
                    </strong>
                  </summary>
<p>
Same as before.
</p>
<div class="org-src-container">
<pre class="src src-octave"><span class="linenr">57: </span><span style="color: #ff4500;">%% </span><span style="color: #ff4500;">Pre-Processing</span>
<span class="linenr">58: </span>[pcs<span style="color: #b0c4de;">,</span> bcs<span style="color: #b0c4de;">,</span> joints<span style="color: #b0c4de;">,</span> excs<span style="color: #b0c4de;">,</span> Klib] <span style="color: #b0c4de;">=</span> WBPREPROC(pcs<span style="color: #b0c4de;">,</span> bcs<span style="color: #b0c4de;">,</span> joints<span style="color: #b0c4de;">,</span> excs<span style="color: #b0c4de;">,</span> Klib)<span style="color: #b0c4de;">;</span>
</pre>
</div>


</details>
<details class="code-details"
                 style ="padding: 1em;
                          background-color: white;
                          /* background-color: pink; */
                          border-radius: 15px;
                          color: hsl(157 75%);
                          font-size: 0.9em;
                          box-shadow: 0.05em 0.1em 5px 0.01em  #00000057;">
                  <summary>
                    <strong>
                      <font face="Courier" size="3" color="black">
                         Setup continuation properties for the forced response analysis
                      </font>
                    </strong>
                  </summary>
<div class="org-src-container">
<pre class="src src-octave"><span class="linenr">59: </span>Npts <span style="color: #b0c4de;">=</span> pcs(end).irange(end)<span style="color: #b0c4de;">;</span>  <span style="color: #ff4500;">% Number of points in model</span>
<span class="linenr">60: </span>Nwc <span style="color: #b0c4de;">=</span> size(wcomps<span style="color: #b0c4de;">,</span>1)<span style="color: #b0c4de;">;</span>  <span style="color: #ff4500;">% Number of wave coefficients per point</span>
<span class="linenr">61: </span>
<span class="linenr">62: </span>Nh <span style="color: #b0c4de;">=</span> length(h)<span style="color: #b0c4de;">;</span>  <span style="color: #ff4500;">% Number of harmonics</span>
<span class="linenr">63: </span>Nhc <span style="color: #b0c4de;">=</span> sum((h<span style="color: #b0c4de;">==</span>0)<span style="color: #b0c4de;">+</span>2<span style="color: #b0c4de;">*</span>(h<span style="color: #b0c4de;">~=</span>0))<span style="color: #b0c4de;">;</span>  <span style="color: #ff4500;">% Number of harmonic coefficients</span>
<span class="linenr">64: </span><span style="color: #ff4500;">% </span><span style="color: #ff4500;">Indices for easy conversion between complex and real representations</span>
<span class="linenr">65: </span>[zinds<span style="color: #b0c4de;">,</span>hinds<span style="color: #b0c4de;">,</span>rinds0<span style="color: #b0c4de;">,</span>rinds<span style="color: #b0c4de;">,</span>iinds] <span style="color: #b0c4de;">=</span> HINDS(Npts<span style="color: #b0c4de;">*</span>Nwc<span style="color: #b0c4de;">,</span> h)<span style="color: #b0c4de;">;</span>
<span class="linenr">66: </span>
<span class="linenr">67: </span><span style="color: #ff4500;">% </span><span style="color: #ff4500;">Frequency limits for continuation</span>
<span class="linenr">68: </span>Wst <span style="color: #b0c4de;">=</span> 1055.5<span style="color: #b0c4de;">;</span>
<span class="linenr">69: </span>Wen <span style="color: #b0c4de;">=</span> 1055.9<span style="color: #b0c4de;">;</span>
<span class="linenr">70: </span>dw <span style="color: #b0c4de;">=</span> 0.1<span style="color: #b0c4de;">;</span>  <span style="color: #ff4500;">% Continuation step size</span>
<span class="linenr">71: </span>
<span class="linenr">72: </span><span style="color: #ff4500;">% </span><span style="color: #ff4500;">Continuation properties</span>
<span class="linenr">73: </span>Copt <span style="color: #b0c4de;">=</span> struct(<span style="color: #ffa07a;">'Nmax'</span><span style="color: #b0c4de;">,</span> 300<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'angopt'</span><span style="color: #b0c4de;">,</span> 1e<span style="color: #b0c4de;">-</span>1<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'DynDscale'</span><span style="color: #b0c4de;">,</span> 1)<span style="color: #b0c4de;">;</span>
<span class="linenr">74: </span>
<span class="linenr">75: </span>Famps <span style="color: #b0c4de;">=</span> 2e3<span style="color: #b0c4de;">*</span>[1 10 20]<span style="color: #b0c4de;">;</span>  <span style="color: #ff4500;">% Forcing levels for analysis</span>
<span class="linenr">76: </span>acC <span style="color: #b0c4de;">=</span> cell(size(Famps))<span style="color: #b0c4de;">;</span>  <span style="color: #ff4500;">% Cells to store the responses</span>
</pre>
</div>


</details>
<details class="code-details"
                 style ="padding: 1em;
                          background-color: #c9c9c9;
                          /* background-color: pink; */
                          border-radius: 15px;
                          color: hsl(157 75%);
                          font-size: 0.9em;
                          box-shadow: 0.05em 0.1em 5px 0.01em  #00000057;">
                  <summary>
                    <strong>
                      <font face="Courier" size="3" color="black">
                         Conduct the continuation analysis
                      </font>
                    </strong>
                  </summary>
<p>
Continuation is initiated and conducted in a pretty similar fashion as before.
</p>
<div class="org-src-container">
<pre class="src src-octave"><span class="linenr">77: </span><span style="color: #00ffff;">for</span> fi<span style="color: #b0c4de;">=</span>1<span style="color: #b0c4de;">:</span>length(Famps)
<span class="linenr">78: </span>    <span style="color: #ff4500;">% Setup Linear Initial Guess</span>
<span class="linenr">79: </span>    [Amat<span style="color: #b0c4de;">,</span> <span style="color: #b0c4de;">~,</span> <span style="color: #b0c4de;">~,</span> Fv] <span style="color: #b0c4de;">=</span> WVAMAT([Wst<span style="color: #b0c4de;">;</span>0]<span style="color: #b0c4de;">,</span> h<span style="color: #b0c4de;">,</span> pcs<span style="color: #b0c4de;">,</span> bcs<span style="color: #b0c4de;">,</span> joints<span style="color: #b0c4de;">,</span> Klib<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'r'</span>)<span style="color: #b0c4de;">;</span>
<span class="linenr">80: </span>    ari0 <span style="color: #b0c4de;">=</span> Amat<span style="color: #b0c4de;">\</span>Fv<span style="color: #b0c4de;">*</span>Famps(fi)<span style="color: #b0c4de;">;</span> 
<span class="linenr">81: </span>    <span style="color: #ff4500;">%NOTE: This does NOT linearize the joint. This merely assumes no joint</span>
<span class="linenr">82: </span>    <span style="color: #ff4500;">%is present.</span>
<span class="linenr">83: </span>    Copt.Dscale <span style="color: #b0c4de;">=</span> [abs(ari0<span style="color: #b0c4de;">+</span>1e<span style="color: #b0c4de;">-</span>6)<span style="color: #b0c4de;">;</span>Wst]<span style="color: #b0c4de;">;</span>  <span style="color: #ff4500;">% Setup Scaling for continuation (sometimes helps)</span>
<span class="linenr">84: </span>
<span class="linenr">85: </span>    <span style="color: #ff4500;">% Conduct continuation</span>
<span class="linenr">86: </span>    ariwC <span style="color: #b0c4de;">=</span> CONTINUE(@(ariw) WVHBRESFUN(ariw<span style="color: #b0c4de;">,</span> Famps(fi)<span style="color: #b0c4de;">,</span> h<span style="color: #b0c4de;">,</span> pcs<span style="color: #b0c4de;">,</span> bcs<span style="color: #b0c4de;">,</span> joints<span style="color: #b0c4de;">,</span> Klib)<span style="color: #b0c4de;">,</span> <span style="color: #b0c4de;">...</span>
<span class="linenr">87: </span>        ari0<span style="color: #b0c4de;">,</span> Wst<span style="color: #b0c4de;">,</span> Wen<span style="color: #b0c4de;">,</span> dw<span style="color: #b0c4de;">,</span> Copt)<span style="color: #b0c4de;">;</span>
<span class="linenr">88: </span>
<span class="linenr">89: </span>    <span style="color: #ff4500;">% Convert to complex representation</span>
<span class="linenr">90: </span>    acC{fi} <span style="color: #b0c4de;">=</span> zeros(Npts<span style="color: #b0c4de;">*</span>Nwc<span style="color: #b0c4de;">*</span>Nh<span style="color: #b0c4de;">+</span>1<span style="color: #b0c4de;">,</span> size(ariwC<span style="color: #b0c4de;">,</span>2))<span style="color: #b0c4de;">;</span>
<span class="linenr">91: </span>    acC{fi}([zinds hinds end]<span style="color: #b0c4de;">,</span> <span style="color: #b0c4de;">:</span>) <span style="color: #b0c4de;">=</span> [ariwC(rinds0<span style="color: #b0c4de;">,:</span>)<span style="color: #b0c4de;">;</span> ariwC(rinds<span style="color: #b0c4de;">,:</span>)<span style="color: #b0c4de;">+</span>1j<span style="color: #b0c4de;">*</span>ariwC(iinds<span style="color: #b0c4de;">,:</span>)<span style="color: #b0c4de;">;</span>ariwC(end<span style="color: #b0c4de;">,:</span>)]<span style="color: #b0c4de;">;</span>
<span class="linenr">92: </span><span style="color: #00ffff;">end</span>
</pre>
</div>


</details>
<details class="code-details"
                 style ="padding: 1em;
                          background-color: white;
                          /* background-color: pink; */
                          border-radius: 15px;
                          color: hsl(157 75%);
                          font-size: 0.9em;
                          box-shadow: 0.05em 0.1em 5px 0.01em  #00000057;">
                  <summary>
                    <strong>
                      <font face="Courier" size="3" color="black">
                         Plot the response
                      </font>
                    </strong>
                  </summary>
<p>
Plot the response at the excitation location.
</p>
<div class="org-src-container">
<pre class="src src-octave"><span class="linenr"> 93: </span><span style="color: #ff4500;">%% </span><span style="color: #ff4500;">Plot Results</span>
<span class="linenr"> 94: </span>opi <span style="color: #b0c4de;">=</span> 5<span style="color: #b0c4de;">:</span>8<span style="color: #b0c4de;">;</span>
<span class="linenr"> 95: </span>figure(1)
<span class="linenr"> 96: </span>clf()
<span class="linenr"> 97: </span>aa <span style="color: #b0c4de;">=</span> gobjects(size(Famps))<span style="color: #b0c4de;">;</span>
<span class="linenr"> 98: </span><span style="color: #00ffff;">for</span> fi<span style="color: #b0c4de;">=</span>1<span style="color: #b0c4de;">:</span>length(Famps)
<span class="linenr"> 99: </span>    subplot(2<span style="color: #b0c4de;">,</span>1<span style="color: #b0c4de;">,</span>1)
<span class="linenr">100: </span>    aa(fi)<span style="color: #b0c4de;">=</span>plot(acC{fi}(end<span style="color: #b0c4de;">,:</span>)<span style="color: #b0c4de;">,</span> abs(sum(2<span style="color: #b0c4de;">*</span>acC{fi}(opi<span style="color: #b0c4de;">,:</span>)))<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'-'</span><span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'LineWidth'</span><span style="color: #b0c4de;">,</span> 2)<span style="color: #b0c4de;">;</span> hold on
<span class="linenr">101: </span>    legend(aa(fi)<span style="color: #b0c4de;">,</span> sprintf(<span style="color: #ffa07a;">'F = %.0f kN'</span><span style="color: #b0c4de;">,</span> Famps(fi)<span style="color: #b0c4de;">/</span>1e3))<span style="color: #b0c4de;">;</span>
<span class="linenr">102: </span>    grid on
<span class="linenr">103: </span>    ylabel(<span style="color: #ffa07a;">'Response (m)'</span>)
<span class="linenr">104: </span>    subplot(2<span style="color: #b0c4de;">,</span>1<span style="color: #b0c4de;">,</span>2)
<span class="linenr">105: </span>    plot(acC{fi}(end<span style="color: #b0c4de;">,:</span>)<span style="color: #b0c4de;">,</span> rad2deg(angle(sum(2<span style="color: #b0c4de;">*</span>acC{fi}(opi<span style="color: #b0c4de;">,:</span>))))<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'-'</span><span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'LineWidth'</span><span style="color: #b0c4de;">,</span> 2)<span style="color: #b0c4de;">;</span> hold on
<span class="linenr">106: </span>    grid on
<span class="linenr">107: </span>    ylabel(<span style="color: #ffa07a;">'Phase (degs)'</span>)
<span class="linenr">108: </span><span style="color: #00ffff;">end</span>
<span class="linenr">109: </span>subplot(2<span style="color: #b0c4de;">,</span>1<span style="color: #b0c4de;">,</span>1)
<span class="linenr">110: </span>xlim([Wst Wen])
<span class="linenr">111: </span>legend(aa<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'Location'</span><span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'northwest'</span>)
<span class="linenr">112: </span>subplot(2<span style="color: #b0c4de;">,</span>1<span style="color: #b0c4de;">,</span>2)
<span class="linenr">113: </span>xlim([Wst Wen])
<span class="linenr">114: </span>set(gca<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'YTick'</span><span style="color: #b0c4de;">,</span> <span style="color: #b0c4de;">-</span>180<span style="color: #b0c4de;">:</span>90<span style="color: #b0c4de;">:</span>180)
<span class="linenr">115: </span>xlabel(<span style="color: #ffa07a;">'Frequency (rad/s)'</span>)
</pre>
</div>


</details>
</div>
</div>
<div id="outline-container-orgbb19821" class="outline-4">
<h4 id="orgbb19821"><span class="section-number-4">3.4.2.</span> Results</h4>
<div class="outline-text-4" id="text-3-4-2">

<div id="org7642c43" class="figure">
<p><img src="./FIGS/d_out.png" alt="d_out.png" width="600px" />
</p>
<p><span class="figure-number">Figure 5: </span>Forced response of the non-linear-jointed beam.</p>
</div>
</div>
</div>
<div id="outline-container-org7aded87" class="outline-4">
<h4 id="org7aded87"><span class="section-number-4">3.4.3.</span> <span class="todo TODO">TODO</span> Include a nicely labeled schematic of the considered system</h4>
</div>
<div id="outline-container-orgd91dc32" class="outline-4">
<h4 id="orgd91dc32"><span class="section-number-4">3.4.4.</span> <span class="todo TODO">TODO</span> Describe how to use WVEVALWCOFS for evaluating wave coefficients and plot deflection shape.</h4>
</div>
</div>
<div id="outline-container-orgc603825" class="outline-3">
<h3 id="orgc603825"><span class="section-number-3">3.5.</span> Impacting Cantilever Beams</h3>
<div class="outline-text-3" id="text-3-5">
<p>
This is an example from <a href="#citeproc_bib_item_4">[4]</a>, where the dynamics of an impacting cantilever beam setup is investigated. The technical interest in this example is motivated from the broader are of vibro-impact dynamics<a href="#citeproc_bib_item_5">[5]</a>, wherein the advantages of the wave based approach are expected to be particularly relevant (due to the avoidance of spatial discretization).
</p>

<p>
A schematic of the setup is shown below in fig. <a href="#orgd5d1020">6</a> and the material properties used for this example are presented in tab. <a href="#orgb0856cd">2</a>.
</p>

<div id="orgd5d1020" class="figure">
<p><img src="./FIGS/iclbeamsetup.png" alt="iclbeamsetup.png" />
</p>
<p><span class="figure-number">Figure 6: </span>Schematic of the impacting cantilever beam setup <a href="#citeproc_bib_item_4">[4]</a></p>
</div>
<table id="orgb0856cd" border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">
<caption class="t-above"><span class="table-number">Table 2:</span> Material Properties assumed for the example in <a href="https://github.com/Nidish96/wavevib/tree/master/EXAMPLES/e_nlimpactclbeams.m">https://github.com/Nidish96/wavevib/tree/master/EXAMPLES/e_nlimpactclbeams.m</a></caption>

<colgroup>
<col  class="org-right" />

<col  class="org-right" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />

<col  class="org-right" />

<col  class="org-right" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-right">Young's Modulus (GPa)</th>
<th scope="col" class="org-right">Density (kg/m<sup>3</sup>)</th>
<th scope="col" class="org-left">Section (mm<sup>2</sup>)</th>
<th scope="col" class="org-left">Lengths (mm)</th>
<th scope="col" class="org-left">Excitation Point (mm)</th>
<th scope="col" class="org-left">Rayleigh damping (&alpha;, &beta;)</th>
<th scope="col" class="org-right">Contact Gap (mm)</th>
<th scope="col" class="org-right">Contact Stiffness (N/m)</th>
</tr>
</thead>
<tbody>
<tr>
<td class="org-right">210</td>
<td class="org-right">7680</td>
<td class="org-left">3 &times; 40</td>
<td class="org-left">560, 445</td>
<td class="org-left">560/6</td>
<td class="org-left">(0.80, 1.1&times; 10<sup>-4</sup>)</td>
<td class="org-right">2.5</td>
<td class="org-right">110</td>
</tr>
</tbody>
</table>
</div>
<div id="outline-container-orga4f4fa9" class="outline-4">
<h4 id="orga4f4fa9"><span class="section-number-4">3.5.1.</span> Code Overview</h4>
<div class="outline-text-4" id="text-3-5-1">
<p>
The most important part of the code are from line 16 to line 107. The complete code is explained below in different blocks (click to expand each block).
</p>
<details class="code-details"
                 style ="padding: 1em;
                          background-color: #c9c9c9;
                          /* background-color: pink; */
                          border-radius: 15px;
                          color: hsl(157 75%);
                          font-size: 0.9em;
                          box-shadow: 0.05em 0.1em 5px 0.01em  #00000057;">
                  <summary>
                    <strong>
                      <font face="Courier" size="3" color="black">
                         Declare Properties
                      </font>
                    </strong>
                  </summary>
<p>
Here we just assign variables to the properties that will be useful for declaring properties.
</p>
<div class="org-src-container">
<pre class="src src-octave" id="org625e19b"><span class="linenr"> 1: </span>addpath(<span style="color: #ffa07a;">'../ROUTINES/SOLVERS/'</span>)
<span class="linenr"> 2: </span>addpath(<span style="color: #ffa07a;">'../ROUTINES/WBM/'</span>)
<span class="linenr"> 3: </span>
<span class="linenr"> 4: </span><span style="color: #ff4500;">%% </span><span style="color: #ff4500;">Setup Model</span>
<span class="linenr"> 5: </span>Ey <span style="color: #b0c4de;">=</span> 2.1e11<span style="color: #b0c4de;">;</span>
<span class="linenr"> 6: </span>rho <span style="color: #b0c4de;">=</span> 7680<span style="color: #b0c4de;">;</span>
<span class="linenr"> 7: </span>thk <span style="color: #b0c4de;">=</span> 3e<span style="color: #b0c4de;">-</span>3<span style="color: #b0c4de;">;</span>   <span style="color: #ff4500;">% Thickness 1</span>
<span class="linenr"> 8: </span>wid  <span style="color: #b0c4de;">=</span> 40e<span style="color: #b0c4de;">-</span>3<span style="color: #b0c4de;">;</span>  <span style="color: #ff4500;">% Width</span>
<span class="linenr"> 9: </span>Ar <span style="color: #b0c4de;">=</span> thk<span style="color: #b0c4de;">*</span>wid<span style="color: #b0c4de;">;</span>  <span style="color: #ff4500;">% Area</span>
<span class="linenr">10: </span>Iy <span style="color: #b0c4de;">=</span> thk<span style="color: #b0c4de;">^</span>3<span style="color: #b0c4de;">*</span>wid<span style="color: #b0c4de;">/</span>12<span style="color: #b0c4de;">;</span>  <span style="color: #ff4500;">% 2nd moment of area</span>
<span class="linenr">11: </span>L1  <span style="color: #b0c4de;">=</span> 560e<span style="color: #b0c4de;">-</span>3<span style="color: #b0c4de;">;</span>  <span style="color: #ff4500;">% Primary beam length</span>
<span class="linenr">12: </span>xF1 <span style="color: #b0c4de;">=</span> L1<span style="color: #b0c4de;">/</span>6<span style="color: #b0c4de;">;</span>    <span style="color: #ff4500;">% Excitation Location (on primary beam)</span>
<span class="linenr">13: </span>L2 <span style="color: #b0c4de;">=</span> 445e<span style="color: #b0c4de;">-</span>3<span style="color: #b0c4de;">;</span>  <span style="color: #ff4500;">% Secondary beam length (each)</span>
<span class="linenr">14: </span>al <span style="color: #b0c4de;">=</span> 0.80<span style="color: #b0c4de;">;</span>    <span style="color: #ff4500;">% 0.80, 1.80</span>
<span class="linenr">15: </span>bt <span style="color: #b0c4de;">=</span> 1.1e<span style="color: #b0c4de;">-</span>4<span style="color: #b0c4de;">;</span>  <span style="color: #ff4500;">% 1.1e-4, 2.475e-4</span>
<span class="linenr">16: </span><span style="color: #ff4500;">% </span><span style="color: #ff4500;">Joint parameters</span>
<span class="linenr">17: </span>knl <span style="color: #b0c4de;">=</span> 220<span style="color: #b0c4de;">/</span>2<span style="color: #b0c4de;">;</span>      <span style="color: #ff4500;">% 220,      880,    (242, 484, 880, 1210)</span>
<span class="linenr">18: </span>gap <span style="color: #b0c4de;">=</span> 2.5e<span style="color: #b0c4de;">-</span>3<span style="color: #b0c4de;">;</span>   <span style="color: #ff4500;">% 2.5e-3,   0.35,   0.35</span>
</pre>
</div>


</details>
<details class="code-details"
                 style ="padding: 1em;
                          background-color: white;
                          /* background-color: pink; */
                          border-radius: 15px;
                          color: hsl(157 75%);
                          font-size: 0.9em;
                          box-shadow: 0.05em 0.1em 5px 0.01em  #00000057;">
                  <summary>
                    <strong>
                      <font face="Courier" size="3" color="#2980b9">
                         Declare Dispersion Relationship
                      </font>
                    </strong>
                  </summary>
<p>
Here we declare the dispersion relationship that will be used in the model
</p>
<div class="org-src-container">
<pre class="src src-octave" id="org6a695c5"><span class="linenr">19: </span><span style="color: #ff4500;">% </span><span style="color: #ff4500;">Declare a library of dispersion relationships (only one here) </span>
<span class="linenr">20: </span>Klib <span style="color: #b0c4de;">=</span> struct(<span style="color: #ffa07a;">'K'</span><span style="color: #b0c4de;">,</span> @(w<span style="color: #b0c4de;">,</span>xi) ((rho<span style="color: #b0c4de;">*</span>Ar<span style="color: #b0c4de;">*</span>(w<span style="color: #b0c4de;">.^</span>2<span style="color: #b0c4de;">+</span>1j<span style="color: #b0c4de;">*</span>w<span style="color: #b0c4de;">*</span>al))<span style="color: #b0c4de;">./</span>(Ey<span style="color: #b0c4de;">*</span>Iy<span style="color: #b0c4de;">*</span>(1<span style="color: #b0c4de;">-</span>1j<span style="color: #b0c4de;">*</span>w<span style="color: #b0c4de;">*</span>bt)))<span style="color: #b0c4de;">.^</span>(0.25) )<span style="color: #b0c4de;">;</span> 
<span class="linenr">21: </span>wcomps <span style="color: #b0c4de;">=</span> [1 1<span style="color: #b0c4de;">;</span>  <span style="color: #ff4500;">% First component -&gt; exp(  k x )</span>
<span class="linenr">22: </span>         <span style="color: #b0c4de;">-</span>1 1<span style="color: #b0c4de;">;</span>  <span style="color: #ff4500;">% Second component-&gt; exp( -k x )</span>
<span class="linenr">23: </span>                                 1j 1<span style="color: #b0c4de;">;</span>  <span style="color: #ff4500;">% Third component -&gt; exp( ik x )</span>
<span class="linenr">24: </span>                                <span style="color: #b0c4de;">-</span>1j 1]<span style="color: #b0c4de;">;</span> <span style="color: #ff4500;">% Fourth component-&gt; exp(-ik x )</span>
<span class="linenr">25: </span>
<span class="linenr">26: </span><span style="color: #ff4500;">% </span><span style="color: #ff4500;">If multiple dispersion relationships are present in a model, Klib</span>
<span class="linenr">27: </span><span style="color: #ff4500;">% </span><span style="color: #ff4500;">must be declared as a vector of structs, and the second column of</span>
<span class="linenr">28: </span><span style="color: #ff4500;">% </span><span style="color: #ff4500;">wcomps must be used to refer to an appropriate entry in this.</span>
</pre>
</div>
<p>
The format is that the 'K' is a function of frequency 'w' and some parameter (could be vector) 'xi'. The array wcomps declares how to use the dispersion relationships from the 'Klib' library structure.
</p>

<p>
Here is an example of how to declare multiple dispersion relationships:
</p>
<div class="org-src-container">
<pre class="src src-octave" id="orgfcc45c1">Klib <span style="color: #b0c4de;">=</span> [struct(<span style="color: #ffa07a;">'K'</span><span style="color: #b0c4de;">,</span> @(w<span style="color: #b0c4de;">,</span>xi) sqrt((<span style="color: #b0c4de;">-</span>b.v(w<span style="color: #b0c4de;">,</span>xi)<span style="color: #b0c4de;">+</span>sqrt(b.v(w<span style="color: #b0c4de;">,</span>xi)<span style="color: #b0c4de;">.^</span>2<span style="color: #b0c4de;">-</span>4<span style="color: #b0c4de;">*</span>a<span style="color: #b0c4de;">*</span>c.v(w<span style="color: #b0c4de;">,</span>xi)))<span style="color: #b0c4de;">/</span>(2<span style="color: #b0c4de;">*</span>a)))<span style="color: #b0c4de;">;</span> <span style="color: #b0c4de;">...</span>
    struct(<span style="color: #ffa07a;">'K'</span><span style="color: #b0c4de;">,</span> @(w<span style="color: #b0c4de;">,</span>xi) sqrt((<span style="color: #b0c4de;">-</span>b.v(w<span style="color: #b0c4de;">,</span>xi)<span style="color: #b0c4de;">-</span>sqrt(b.v(w<span style="color: #b0c4de;">,</span>xi)<span style="color: #b0c4de;">.^</span>2<span style="color: #b0c4de;">-</span>4<span style="color: #b0c4de;">*</span>a<span style="color: #b0c4de;">*</span>c.v(w<span style="color: #b0c4de;">,</span>xi)))<span style="color: #b0c4de;">/</span>(2<span style="color: #b0c4de;">*</span>a)))]<span style="color: #b0c4de;">;</span>
wcomps <span style="color: #b0c4de;">=</span> [1j 1<span style="color: #b0c4de;">;</span>  <span style="color: #ff4500;">% +jK1</span>
         <span style="color: #b0c4de;">-</span>1j 1<span style="color: #b0c4de;">;</span>  <span style="color: #ff4500;">% -jK1</span>
          1j 2<span style="color: #b0c4de;">;</span>  <span style="color: #ff4500;">% +jK2</span>
         <span style="color: #b0c4de;">-</span>1j 2]<span style="color: #b0c4de;">;</span> <span style="color: #ff4500;">% -jK2</span>
</pre>
</div>


</details>
<details class="code-details"
                 style ="padding: 1em;
                          background-color: #c9c9c9;
                          /* background-color: pink; */
                          border-radius: 15px;
                          color: hsl(157 75%);
                          font-size: 0.9em;
                          box-shadow: 0.05em 0.1em 5px 0.01em  #00000057;">
                  <summary>
                    <strong>
                      <font face="Courier" size="3" color="black">
                         Setup the model, boundary conditions, and excitation
                      </font>
                    </strong>
                  </summary>
<ul class="org-ul">
<li><p>
Firstly, the difference "pieces" of the model are specified:
</p>
<div class="org-src-container">
<pre class="src src-octave" id="orged03a4b"><span class="linenr">29: </span><span style="color: #ff4500;">% </span><span style="color: #ff4500;">Setup "wave-based pieces"</span>
<span class="linenr">30: </span>pcs <span style="color: #b0c4de;">=</span> [struct(<span style="color: #ffa07a;">'coords'</span><span style="color: #b0c4de;">,</span> [0 0<span style="color: #b0c4de;">;</span>xF1 0<span style="color: #b0c4de;">;</span>L1 0]<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'wcomps'</span><span style="color: #b0c4de;">,</span> wcomps)<span style="color: #b0c4de;">;</span>
<span class="linenr">31: </span>                         struct(<span style="color: #ffa07a;">'coords'</span><span style="color: #b0c4de;">,</span> [L1 gap<span style="color: #b0c4de;">;</span>L1<span style="color: #b0c4de;">+</span>L2 gap]<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'wcomps'</span><span style="color: #b0c4de;">,</span> wcomps)<span style="color: #b0c4de;">;</span>
<span class="linenr">32: </span>                         struct(<span style="color: #ffa07a;">'coords'</span><span style="color: #b0c4de;">,</span> [L1 <span style="color: #b0c4de;">-</span>gap<span style="color: #b0c4de;">;</span>L1<span style="color: #b0c4de;">+</span>L2 <span style="color: #b0c4de;">-</span>gap]<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'wcomps'</span><span style="color: #b0c4de;">,</span> wcomps)]<span style="color: #b0c4de;">;</span>
</pre>
</div>
<p>
In this model there are three pieces: one for each beam. The first beam is declared with three coordinate points (each row is a separate point). The second point is introduced at the excitation location. Note here that each piece is also associated with its own wave components (declared above in snippet <a href="#org6a695c5">1</a>).
</p></li>
<li><p>
Next, the boundary conditions are specified:
</p>
<div class="org-src-container">
<pre class="src src-octave" id="org45cf4f3"><span class="linenr">33: </span><span style="color: #ff4500;">%% </span><span style="color: #ff4500;">Setup boundary conditions</span>
<span class="linenr">34: </span>bcs <span style="color: #b0c4de;">=</span> [struct(<span style="color: #ffa07a;">'i'</span><span style="color: #b0c4de;">,</span> 1<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'cofs'</span><span style="color: #b0c4de;">,</span> @(w<span style="color: #b0c4de;">,</span>xi) [1 1 1 1<span style="color: #b0c4de;">;</span> 1 <span style="color: #b0c4de;">-</span>1 1j <span style="color: #b0c4de;">-</span>1j])<span style="color: #b0c4de;">;</span>  <span style="color: #ff4500;">% fixed end</span>
<span class="linenr">35: </span>                         struct(<span style="color: #ffa07a;">'i'</span><span style="color: #b0c4de;">,</span> 5<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'cofs'</span><span style="color: #b0c4de;">,</span> @(w<span style="color: #b0c4de;">,</span>xi) [1 1 1 1<span style="color: #b0c4de;">;</span> 1 <span style="color: #b0c4de;">-</span>1 1j <span style="color: #b0c4de;">-</span>1j])<span style="color: #b0c4de;">;</span>     <span style="color: #ff4500;">% fixed end</span>
<span class="linenr">36: </span>                         struct(<span style="color: #ffa07a;">'i'</span><span style="color: #b0c4de;">,</span> 7<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'cofs'</span><span style="color: #b0c4de;">,</span> @(w<span style="color: #b0c4de;">,</span>xi) [1 1 1 1<span style="color: #b0c4de;">;</span> 1 <span style="color: #b0c4de;">-</span>1 1j <span style="color: #b0c4de;">-</span>1j])<span style="color: #b0c4de;">;</span>     <span style="color: #ff4500;">% fixed end</span>
<span class="linenr">37: </span>                         struct(<span style="color: #ffa07a;">'i'</span><span style="color: #b0c4de;">,</span> 3<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'cofs'</span><span style="color: #b0c4de;">,</span> @(w<span style="color: #b0c4de;">,</span>xi) [1 1 <span style="color: #b0c4de;">-</span>1 <span style="color: #b0c4de;">-</span>1])<span style="color: #b0c4de;">;</span>        <span style="color: #ff4500;">% Moment-free</span>
<span class="linenr">38: </span>                         struct(<span style="color: #ffa07a;">'i'</span><span style="color: #b0c4de;">,</span> 4<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'cofs'</span><span style="color: #b0c4de;">,</span> @(w<span style="color: #b0c4de;">,</span>xi) [1 1 <span style="color: #b0c4de;">-</span>1 <span style="color: #b0c4de;">-</span>1])<span style="color: #b0c4de;">;</span>        <span style="color: #ff4500;">% Moment-free</span>
<span class="linenr">39: </span>                         struct(<span style="color: #ffa07a;">'i'</span><span style="color: #b0c4de;">,</span> 6<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'cofs'</span><span style="color: #b0c4de;">,</span> @(w<span style="color: #b0c4de;">,</span>xi) [1 1 <span style="color: #b0c4de;">-</span>1 <span style="color: #b0c4de;">-</span>1])]<span style="color: #b0c4de;">;</span>       <span style="color: #ff4500;">% Moment-free</span>
</pre>
</div>
<p>
The parameter 'i' specifies the point in the pieces structure where the boundary condition is specified. The indexing is global, i.e., the points are counted in the order provided; piece 1 has points 1-3, piece 2 has points 4-5, and piece 3 has points 6-7.
</p></li>
<li><p>
Now the excitation is specified:
</p>
<div class="org-src-container">
<pre class="src src-octave"><span class="linenr">40: </span><span style="color: #ff4500;">%% </span><span style="color: #ff4500;">Setup excitation (unit magnitude assumed)</span>
<span class="linenr">41: </span>Mx <span style="color: #b0c4de;">=</span> @(w<span style="color: #b0c4de;">,</span>xi) inv([Ey<span style="color: #b0c4de;">*</span>Iy<span style="color: #b0c4de;">*</span>Klib.K(w<span style="color: #b0c4de;">,</span>xi)<span style="color: #b0c4de;">^</span>3<span style="color: #b0c4de;">*</span>[<span style="color: #b0c4de;">-</span>1 1 1j <span style="color: #b0c4de;">-</span>1j]<span style="color: #b0c4de;">;</span>
<span class="linenr">42: </span>                  Ey<span style="color: #b0c4de;">*</span>Iy<span style="color: #b0c4de;">*</span>Klib.K(w<span style="color: #b0c4de;">,</span>xi)<span style="color: #b0c4de;">^</span>2<span style="color: #b0c4de;">*</span>[<span style="color: #b0c4de;">-</span>1 <span style="color: #b0c4de;">-</span>1 1 1]<span style="color: #b0c4de;">;</span>
<span class="linenr">43: </span>                  [1 1 1 1]<span style="color: #b0c4de;">;</span>
<span class="linenr">44: </span>                  Klib.K(w<span style="color: #b0c4de;">,</span>xi)<span style="color: #b0c4de;">*</span>[1 <span style="color: #b0c4de;">-</span>1 1j <span style="color: #b0c4de;">-</span>1j]])<span style="color: #b0c4de;">;</span>
<span class="linenr">45: </span>
<span class="linenr">46: </span>excs <span style="color: #b0c4de;">=</span> struct(<span style="color: #ffa07a;">'i'</span><span style="color: #b0c4de;">,</span> 2<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'nh'</span><span style="color: #b0c4de;">,</span> 1<span style="color: #b0c4de;">,</span> <span style="color: #b0c4de;">...</span>
<span class="linenr">47: </span>    <span style="color: #ffa07a;">'rcofs'</span><span style="color: #b0c4de;">,</span> @(w<span style="color: #b0c4de;">,</span>xi) Mx(w<span style="color: #b0c4de;">,</span>xi)<span style="color: #b0c4de;">*</span>[1<span style="color: #b0c4de;">/</span>2<span style="color: #b0c4de;">;</span>0<span style="color: #b0c4de;">;</span>0<span style="color: #b0c4de;">;</span>0])<span style="color: #b0c4de;">;</span>
<span class="linenr">48: </span><span style="color: #ff4500;">%</span><span style="color: #ff4500;">'nh' sets the harmonic at which to apply the excitation</span>
</pre>
</div></li>
</ul>


</details>
<details class="code-details"
                 style ="padding: 1em;
                          background-color: white;
                          /* background-color: pink; */
                          border-radius: 15px;
                          color: hsl(157 75%);
                          font-size: 0.9em;
                          box-shadow: 0.05em 0.1em 5px 0.01em  #00000057;">
                  <summary>
                    <strong>
                      <font face="Courier" size="3" color="#2980b9">
                         Setup the Nonlinear Joint after Specifying AFT
                      </font>
                    </strong>
                  </summary>
<ul class="org-ul">
<li><p>
We now specify the non-linear joint. This is done by first specifying the AFT (Alternating Frequency-Time) parameters:
</p>
<div class="org-src-container">
<pre class="src src-octave"><span class="linenr">49: </span><span style="color: #ff4500;">%% </span><span style="color: #ff4500;">Setup AFT Parameters</span>
<span class="linenr">50: </span>h <span style="color: #b0c4de;">=</span> (1<span style="color: #b0c4de;">:</span>5)<span style="color: #b0c4de;">';</span>  <span style="color: #ff4500;">% List of harmonics to balance</span>
<span class="linenr">51: </span>Nt <span style="color: #b0c4de;">=</span> 2<span style="color: #b0c4de;">^</span>10<span style="color: #b0c4de;">;</span>   <span style="color: #ff4500;">% Number of time samples for AFT</span>
</pre>
</div></li>
<li><p>
The beam interactions are modeled as a three-way joint connecting the three beams. Denoting the relevant tip displacement of the primary beam as beam \(u_1\), and the two secondary beams as \(u_{2a}\) and \(u_{2b}\) respectfully, the force balance equations are,
</p>
\begin{align}
\label{org2f8d769}
  -E_y I_y \frac{\partial^3 u_{2a}}{\partial x^3} &= f_{joint} (u_{2a}-u_1)\\
  -E_y I_y \frac{\partial^3 u_{2b}}{\partial x^3} &= f_{joint} (u_{2b}-u_1)\\
  -E_y I_y \frac{\partial^3 u_1}{\partial x^3} &= -E_y I_y \left(\frac{\partial^3 u_{2a}}{\partial x^3} + \frac{\partial^3 u_{2b}}{\partial x^3} \right)
\end{align}
<p>
This is setup in the wave-based context as
</p>
<div class="org-src-container">
<pre class="src src-octave"><span class="linenr">52: </span><span style="color: #ff4500;">%% </span><span style="color: #ff4500;">Setup the joint</span>
<span class="linenr">53: </span>cofs <span style="color: #b0c4de;">=</span> @(w<span style="color: #b0c4de;">,</span>xi) [<span style="color: #b0c4de;">-</span>[zeros(1<span style="color: #b0c4de;">,</span>4) 1 <span style="color: #b0c4de;">-</span>1 <span style="color: #b0c4de;">-</span>1j 1j zeros(1<span style="color: #b0c4de;">,</span>4)]<span style="color: #b0c4de;">;</span>
<span class="linenr">54: </span>    <span style="color: #b0c4de;">-</span>[zeros(1<span style="color: #b0c4de;">,</span>8) 1 <span style="color: #b0c4de;">-</span>1 <span style="color: #b0c4de;">-</span>1j 1j]<span style="color: #b0c4de;">;</span>
<span class="linenr">55: </span>    kron([1 <span style="color: #b0c4de;">-</span>1 <span style="color: #b0c4de;">-</span>1]<span style="color: #b0c4de;">,</span> [1 <span style="color: #b0c4de;">-</span>1 <span style="color: #b0c4de;">-</span>1j 1j])]<span style="color: #b0c4de;">;</span>
<span class="linenr">56: </span>joints <span style="color: #b0c4de;">=</span> struct(<span style="color: #ffa07a;">'type'</span><span style="color: #b0c4de;">,</span> 3<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'is'</span><span style="color: #b0c4de;">,</span> [3 4 6]<span style="color: #b0c4de;">,</span> <span style="color: #b0c4de;">...</span>
<span class="linenr">57: </span>    <span style="color: #ffa07a;">'cofs'</span><span style="color: #b0c4de;">,</span> cofs<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'nl'</span><span style="color: #b0c4de;">,</span> @(Uw) HCONTACT(Uw<span style="color: #b0c4de;">,</span> knl<span style="color: #b0c4de;">,</span> gap<span style="color: #b0c4de;">,</span> h<span style="color: #b0c4de;">,</span> Nt)<span style="color: #b0c4de;">,</span> <span style="color: #b0c4de;">...</span>
<span class="linenr">58: </span>    <span style="color: #ffa07a;">'nldcofs'</span><span style="color: #b0c4de;">,</span> @(w<span style="color: #b0c4de;">,</span>xi) kron([1 <span style="color: #b0c4de;">-</span>1 0<span style="color: #b0c4de;">;</span>1 0 <span style="color: #b0c4de;">-</span>1]<span style="color: #b0c4de;">,</span> [1 1 1 1])<span style="color: #b0c4de;">,</span> <span style="color: #b0c4de;">...</span>
<span class="linenr">59: </span>    <span style="color: #ffa07a;">'nlfcofs'</span><span style="color: #b0c4de;">,</span> @(w<span style="color: #b0c4de;">,</span>xi) [eye(2)<span style="color: #b0c4de;">;</span>0 0]<span style="color: #b0c4de;">/</span>(Ey<span style="color: #b0c4de;">*</span>Iy<span style="color: #b0c4de;">*</span>Klib.K(w<span style="color: #b0c4de;">,</span>xi)<span style="color: #b0c4de;">^</span>3))<span style="color: #b0c4de;">;</span>
</pre>
</div>
<p>
<b>NOTE</b>: The 'nldcofs' specifies the coefficient matrix such that the displacement(s) used as input for the nonlinearity is given as,
</p>
<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />
</colgroup>
<tbody>
<tr>
<td class="org-left">u = NLDCOFS * [a;b]</td>
</tr>
</tbody>
</table>
<p>
where "a" and "b" are the wave coefficients of points 'i' and 'j' respectively.
</p>

<p>
The 'nlfcofs' specifies the coefficient matrix that the results from the nonlinear force function are multiplied with before being added to the equations of motion. The nonlinear forces are added in the LHS of the equations.
</p>

<details class="code-details"
                 style ="padding: 1em;
                          background-color: #c9c9c9;
                          /* background-color: pink; */
                          border-radius: 15px;
                          color: hsl(157 75%);
                          font-size: 0.9em;
                          box-shadow: 0.05em 0.1em 5px 0.01em  #00000057;">
                  <summary>
                    <strong>
                      <font face="Courier" size="3" color="black">
                         The nonlinearity function HCONTACT
                      </font>
                    </strong>
                  </summary>
<p>
This function conducts AFT and evaluates the linear-penalty contact model and returns the harmonics of the force for a given set of displacement harmonics.
The function is implemented in <a href="https://github.com/Nidish96/wavevib/tree/master/EXAMPLES/HCONTACT.m">HCONTACT.m</a>.
</p>
<div class="org-src-container">
<pre class="src src-octave"><span style="color: #00ffff;">function</span> [FNL<span style="color: #b0c4de;">,</span> dFNLdU<span style="color: #b0c4de;">,</span> dFNLdw] <span style="color: #b0c4de;">=</span> <span style="color: #87cefa;">HCONTACT</span>(Uw<span style="color: #b0c4de;">,</span> knl<span style="color: #b0c4de;">,</span> gap<span style="color: #b0c4de;">,</span> h<span style="color: #b0c4de;">,</span> Nt)
<span style="color: #ff4500;">%</span><span style="color: #ff4500;">HCONTACT returns the Fourier Coefficients of the contact model implemented</span>
<span style="color: #ff4500;">%</span><span style="color: #ff4500;">as a linear-penalty model. Force that is returned is:</span>
<span style="color: #ff4500;">%                   </span><span style="color: #ff4500;">knl*max(u-gap, 0)</span>
<span style="color: #ff4500;">%   </span><span style="color: #ff4500;">positive (u-gap) quantity is considered as contact and negative is</span>
<span style="color: #ff4500;">%   </span><span style="color: #ff4500;">considered as separation (zero force). </span>
<span style="color: #ff4500;">%</span>
<span style="color: #ff4500;">%   </span><span style="color: #ff4500;">USAGE: </span>
<span style="color: #ff4500;">%       </span><span style="color: #ff4500;">[FNL, dFNLdU, dFNLdw] = HCONTACT(Uw, knl, gap, h, Nt);</span>
<span style="color: #ff4500;">%   </span><span style="color: #ff4500;">INPUTS:</span>
<span style="color: #ff4500;">%       </span><span style="color: #ff4500;">Uw      : (Nhc*Nd+1,1) Vector of nonlinear relative DOFs+freq.</span>
<span style="color: #ff4500;">%       </span><span style="color: #ff4500;">knl,gap : (scalar) or (Nd,1) parameters</span>
<span style="color: #ff4500;">%       </span><span style="color: #ff4500;">h       : (Nh,1) Vector of Harmonics</span>
<span style="color: #ff4500;">%       </span><span style="color: #ff4500;">Nt      : (int) Number of samples for AFT</span>
<span style="color: #ff4500;">%   </span><span style="color: #ff4500;">OUTPUTS:</span>
<span style="color: #ff4500;">%       </span><span style="color: #ff4500;">FNL     : (Nhc*Nd,1) Force harmonics</span>
<span style="color: #ff4500;">%       </span><span style="color: #ff4500;">dFNLdU  : (Nhc*Nd,Nhc*Nd) Force harmonic jacobian wrt U</span>
<span style="color: #ff4500;">%       </span><span style="color: #ff4500;">dFNLdw  : (Nhc*Nd,1) Force harmonic jacobian wrt w</span>

  Nhc <span style="color: #b0c4de;">=</span> sum((h<span style="color: #b0c4de;">==</span>0)<span style="color: #b0c4de;">+</span>2<span style="color: #b0c4de;">*</span>(h<span style="color: #b0c4de;">~=</span>0))<span style="color: #b0c4de;">;</span>
  cst <span style="color: #b0c4de;">=</span> AFT(eye(Nhc)<span style="color: #b0c4de;">,</span> h<span style="color: #b0c4de;">,</span> Nt<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'f2t'</span>)<span style="color: #b0c4de;">;</span>

  Nd <span style="color: #b0c4de;">=</span> (size(Uw<span style="color: #b0c4de;">,</span>1)<span style="color: #b0c4de;">-</span>1)<span style="color: #b0c4de;">/</span>Nhc<span style="color: #b0c4de;">;</span>  <span style="color: #ff4500;">% Number of harmonics</span>
  <span style="color: #00ffff;">if</span> length(knl)<span style="color: #b0c4de;">==</span>1
                knl <span style="color: #b0c4de;">=</span> ones(1<span style="color: #b0c4de;">,</span>Nd)<span style="color: #b0c4de;">*</span>knl<span style="color: #b0c4de;">;</span>
  <span style="color: #00ffff;">end</span>
  <span style="color: #00ffff;">if</span> length(gap)<span style="color: #b0c4de;">==</span>1
                gap <span style="color: #b0c4de;">=</span> ones(1<span style="color: #b0c4de;">,</span>Nd)<span style="color: #b0c4de;">*</span>gap<span style="color: #b0c4de;">;</span>
  <span style="color: #00ffff;">end</span>

  <span style="color: #ff4500;">% Evaluate nonlinear force through AFT</span>
  ut <span style="color: #b0c4de;">=</span> AFT(reshape(Uw(1<span style="color: #b0c4de;">:</span>end<span style="color: #b0c4de;">-</span>1)<span style="color: #b0c4de;">,</span> Nd<span style="color: #b0c4de;">,</span> Nhc)<span style="color: #b0c4de;">',</span> h<span style="color: #b0c4de;">,</span> Nt<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'f2t'</span>)<span style="color: #b0c4de;">;</span>
  ft <span style="color: #b0c4de;">=</span> knl<span style="color: #b0c4de;">.*</span>max(ut<span style="color: #b0c4de;">-</span>gap<span style="color: #b0c4de;">,</span> 0)<span style="color: #b0c4de;">;</span>
  dfdu <span style="color: #b0c4de;">=</span> knl<span style="color: #b0c4de;">.*</span>(ft<span style="color: #b0c4de;">~=</span>0)<span style="color: #b0c4de;">;</span>

  FNL    <span style="color: #b0c4de;">=</span> reshape(AFT(ft<span style="color: #b0c4de;">,</span> h<span style="color: #b0c4de;">,</span> Nt<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'t2f'</span>)<span style="color: #b0c4de;">',</span> Nd<span style="color: #b0c4de;">*</span>Nhc<span style="color: #b0c4de;">,</span>1)<span style="color: #b0c4de;">;</span>
  dFNLdU <span style="color: #b0c4de;">=</span> zeros(Nd<span style="color: #b0c4de;">*</span>Nhc)<span style="color: #b0c4de;">;</span>
  <span style="color: #00ffff;">for</span> di<span style="color: #b0c4de;">=</span>1<span style="color: #b0c4de;">:</span>Nd
                dFNLdU(di<span style="color: #b0c4de;">:</span>Nd<span style="color: #b0c4de;">:</span>end<span style="color: #b0c4de;">,</span>di<span style="color: #b0c4de;">:</span>Nd<span style="color: #b0c4de;">:</span>end) <span style="color: #b0c4de;">=</span> AFT(dfdu(<span style="color: #b0c4de;">:,</span>di)<span style="color: #b0c4de;">.*</span>cst<span style="color: #b0c4de;">,</span> h<span style="color: #b0c4de;">,</span> Nt<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'t2f'</span>)<span style="color: #b0c4de;">;</span>
  <span style="color: #00ffff;">end</span>
  dFNLdw <span style="color: #b0c4de;">=</span> zeros(Nhc<span style="color: #b0c4de;">*</span>Nd<span style="color: #b0c4de;">,</span>1)<span style="color: #b0c4de;">;</span>
<span style="color: #00ffff;">end</span>
</pre>
</div></li>
</ul>


</details>


</details>

<details class="code-details"
                 style ="padding: 1em;
                          background-color: #c9c9c9;
                          /* background-color: pink; */
                          border-radius: 15px;
                          color: hsl(157 75%);
                          font-size: 0.9em;
                          box-shadow: 0.05em 0.1em 5px 0.01em  #00000057;">
                  <summary>
                    <strong>
                      <font face="Courier" size="3" color="black">
                         Preprocess the model
                      </font>
                    </strong>
                  </summary>
<p>
After the above setup is done, it is necessary to preprocess the model. Some of the main things wavevib does at this juncture is the inclusion of repeated points (excitation point has to be repeated, for example), and then calculating the frequency (and parameter) derivatives of the provided dispersion and coefficient functions. These derivatives are computed in <code>WaveVib</code> through Matlab's <code>symbolic toolbox</code> and then stored as anonymous functions. This might make the <code>WBPREPROC</code> function slightly slow to call, but during execution of the linear or nonlinear analyses, no symbolics is used and will thus be quite fast. This is because symbolics are used to compute the expressions only, but are not saved - these expressions are converted to regular matlab expressions before saving them.
</p>
<div class="org-src-container">
<pre class="src src-octave"><span class="linenr">60: </span><span style="color: #ff4500;">%% </span><span style="color: #ff4500;">Pre-Processing</span>
<span class="linenr">61: </span>[pcs<span style="color: #b0c4de;">,</span> bcs<span style="color: #b0c4de;">,</span> joints<span style="color: #b0c4de;">,</span> excs<span style="color: #b0c4de;">,</span> Klib] <span style="color: #b0c4de;">=</span> WBPREPROC(pcs<span style="color: #b0c4de;">,</span> bcs<span style="color: #b0c4de;">,</span> joints<span style="color: #b0c4de;">,</span> excs<span style="color: #b0c4de;">,</span> Klib)<span style="color: #b0c4de;">;</span>
</pre>
</div>
<p>
The user may check all the objects again now - they will contain additional information in a format that is easy for <code>WaveVib</code> to employ. Please do not call <code>WBPREPROC</code> again on the returned parameters as this will result in duplicated points, etc.
</p>


</details>

<details class="code-details"
                 style ="padding: 1em;
                          background-color: white;
                          /* background-color: pink; */
                          border-radius: 15px;
                          color: hsl(157 75%);
                          font-size: 0.9em;
                          box-shadow: 0.05em 0.1em 5px 0.01em  #00000057;">
                  <summary>
                    <strong>
                      <font face="Courier" size="3" color="#2980b9">
                         Conduct Nonlinear Forced Response Analysis using Continuation
                      </font>
                    </strong>
                  </summary>
<ul class="org-ul">
<li><p>
First the necessary parameters for the continuation are setup:
</p>
<div class="org-src-container">
<pre class="src src-octave"><span class="linenr">62: </span><span style="color: #ff4500;">%% </span><span style="color: #ff4500;">Setup continuation parameters</span>
<span class="linenr">63: </span>Npts <span style="color: #b0c4de;">=</span> pcs(end).irange(end)<span style="color: #b0c4de;">;</span>  <span style="color: #ff4500;">% Number of points in model</span>
<span class="linenr">64: </span>Nwc <span style="color: #b0c4de;">=</span> size(wcomps<span style="color: #b0c4de;">,</span>1)<span style="color: #b0c4de;">;</span>         <span style="color: #ff4500;">% Number of wave coefficients per point (4, here)</span>
<span class="linenr">65: </span>
<span class="linenr">66: </span>Nh <span style="color: #b0c4de;">=</span> length(h)<span style="color: #b0c4de;">;</span>               <span style="color: #ff4500;">% Number of harmonics to balance</span>
<span class="linenr">67: </span>Nhc <span style="color: #b0c4de;">=</span> sum((h<span style="color: #b0c4de;">==</span>0)<span style="color: #b0c4de;">+</span>2<span style="color: #b0c4de;">*</span>(h<span style="color: #b0c4de;">~=</span>0))<span style="color: #b0c4de;">;</span>   <span style="color: #ff4500;">% Number of real harmonic coefficients</span>
<span class="linenr">68: </span>                              <span style="color: #ff4500;">% zero harmonic-1 ; other harmonics-sine &amp; cosine</span>
<span class="linenr">69: </span><span style="color: #ff4500;">% </span><span style="color: #ff4500;">Generate indices for easy conversion between complex and real representation</span>
<span class="linenr">70: </span>[zinds<span style="color: #b0c4de;">,</span>hinds<span style="color: #b0c4de;">,</span>rinds0<span style="color: #b0c4de;">,</span>rinds<span style="color: #b0c4de;">,</span>iinds] <span style="color: #b0c4de;">=</span> HINDS(Npts<span style="color: #b0c4de;">*</span>Nwc<span style="color: #b0c4de;">,</span> h)<span style="color: #b0c4de;">;</span>
<span class="linenr">71: </span>
<span class="linenr">72: </span>Wst <span style="color: #b0c4de;">=</span> 2<span style="color: #b0c4de;">*</span>pi<span style="color: #b0c4de;">*</span>4<span style="color: #b0c4de;">;</span>   <span style="color: #ff4500;">% Starting frequency for continuation</span>
<span class="linenr">73: </span>Wen <span style="color: #b0c4de;">=</span> 2<span style="color: #b0c4de;">*</span>pi<span style="color: #b0c4de;">*</span>12<span style="color: #b0c4de;">;</span>  <span style="color: #ff4500;">% Ending frequency for continuation</span>
<span class="linenr">74: </span>dw <span style="color: #b0c4de;">=</span> 0.75<span style="color: #b0c4de;">;</span>      <span style="color: #ff4500;">% Continuation step length </span>
<span class="linenr">75: </span>
<span class="linenr">76: </span>Famps <span style="color: #b0c4de;">=</span> [0.4 1.0 2.5]<span style="color: #b0c4de;">;</span>  <span style="color: #ff4500;">% List of forcing values to conduct analysis</span>
<span class="linenr">77: </span>
<span class="linenr">78: </span><span style="color: #ff4500;">% </span><span style="color: #ff4500;">Continuation Properties</span>
<span class="linenr">79: </span>Copt <span style="color: #b0c4de;">=</span> struct(<span style="color: #ffa07a;">'Nmax'</span><span style="color: #b0c4de;">,</span> 600<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'angopt'</span><span style="color: #b0c4de;">,</span> 5e<span style="color: #b0c4de;">-</span>2<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'DynDscale'</span><span style="color: #b0c4de;">,</span> 1<span style="color: #b0c4de;">,</span> <span style="color: #b0c4de;">...</span>
<span class="linenr">80: </span>              <span style="color: #ffa07a;">'Dscale'</span><span style="color: #b0c4de;">,</span> [1e<span style="color: #b0c4de;">-</span>6<span style="color: #b0c4de;">*</span>ones(size(ari0))<span style="color: #b0c4de;">;</span>Wst])<span style="color: #b0c4de;">;</span>
<span class="linenr">81: </span><span style="color: #ff4500;">% </span><span style="color: #ff4500;">Nmax: Maximum number of points</span>
<span class="linenr">82: </span><span style="color: #ff4500;">% </span><span style="color: #ff4500;">angopt: optimal angle between points (for steplength adaption)</span>
<span class="linenr">83: </span><span style="color: #ff4500;">% </span><span style="color: #ff4500;">DynDscale: Dynamic "Dscaling".</span>
<span class="linenr">84: </span><span style="color: #ff4500;">% </span><span style="color: #ff4500;">Dscale: Initial Dscale vector (Dscale scales the vector of unknowns)</span>
<span class="linenr">85: </span>
<span class="linenr">86: </span>acC <span style="color: #b0c4de;">=</span> cell(size(Famps))<span style="color: #b0c4de;">;</span>  <span style="color: #ff4500;">% Cell to store solution points</span>
</pre>
</div></li>
<li><p>
Next a loop is run to conduct the actual continuation
</p>
<div class="org-src-container">
<pre class="src src-octave"><span class="linenr"> 87: </span><span style="color: #ff4500;">%% </span><span style="color: #ff4500;">Conduct continuation for the different forcing amplitudes</span>
<span class="linenr"> 88: </span><span style="color: #00ffff;">for</span> fi<span style="color: #b0c4de;">=</span>1<span style="color: #b0c4de;">:</span>length(Famps)
<span class="linenr"> 89: </span>        <span style="color: #ff4500;">% Generate linear initial guess for first point</span>
<span class="linenr"> 90: </span>  [Amat<span style="color: #b0c4de;">,</span> <span style="color: #b0c4de;">~,</span> <span style="color: #b0c4de;">~,</span> Fv] <span style="color: #b0c4de;">=</span> WVAMAT([Wst<span style="color: #b0c4de;">;</span>0]<span style="color: #b0c4de;">,</span> h<span style="color: #b0c4de;">,</span> pcs<span style="color: #b0c4de;">,</span> bcs<span style="color: #b0c4de;">,</span> joints<span style="color: #b0c4de;">,</span> Klib<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'r'</span>)<span style="color: #b0c4de;">;</span>
<span class="linenr"> 91: </span>  ari0 <span style="color: #b0c4de;">=</span> Amat<span style="color: #b0c4de;">\</span>(Fv<span style="color: #b0c4de;">*</span>Famps(fi))<span style="color: #b0c4de;">;</span>
<span class="linenr"> 92: </span>
<span class="linenr"> 93: </span>        <span style="color: #ff4500;">% Run the continuation routine "CONTINUE" by calling the HB residue</span>
<span class="linenr"> 94: </span>        <span style="color: #ff4500;">% function (which actually implements PWE) at the </span>
<span class="linenr"> 95: </span>  ariwC <span style="color: #b0c4de;">=</span> CONTINUE(@(ariw) WVHBRESFUN(ariw<span style="color: #b0c4de;">,</span> Famps(fi)<span style="color: #b0c4de;">,</span> h<span style="color: #b0c4de;">,</span> pcs<span style="color: #b0c4de;">,</span> bcs<span style="color: #b0c4de;">,</span> <span style="color: #b0c4de;">...</span>
<span class="linenr"> 96: </span>                                      joints<span style="color: #b0c4de;">,</span> Klib)<span style="color: #b0c4de;">,</span> ari0<span style="color: #b0c4de;">,</span> Wst<span style="color: #b0c4de;">,</span> Wen<span style="color: #b0c4de;">,</span> <span style="color: #b0c4de;">...</span>
<span class="linenr"> 97: </span>                   dw<span style="color: #b0c4de;">,</span> Copt)<span style="color: #b0c4de;">;</span>  
<span class="linenr"> 98: </span>
<span class="linenr"> 99: </span>  <span style="color: #ff4500;">% Convert to complex representation</span>
<span class="linenr">100: </span>  acC{fi} <span style="color: #b0c4de;">=</span> zeros(Npts<span style="color: #b0c4de;">*</span>Nwc<span style="color: #b0c4de;">*</span>Nh<span style="color: #b0c4de;">+</span>1<span style="color: #b0c4de;">,</span> size(ariwC<span style="color: #b0c4de;">,</span>2))<span style="color: #b0c4de;">;</span> 
<span class="linenr">101: </span>  acC{fi}([zinds hinds end]<span style="color: #b0c4de;">,</span> <span style="color: #b0c4de;">:</span>) <span style="color: #b0c4de;">=</span> <span style="color: #b0c4de;">...</span>
<span class="linenr">102: </span>                [ariwC(rinds0<span style="color: #b0c4de;">,:</span>)<span style="color: #b0c4de;">;</span> ariwC(rinds<span style="color: #b0c4de;">,:</span>)<span style="color: #b0c4de;">+</span>1j<span style="color: #b0c4de;">*</span>ariwC(iinds<span style="color: #b0c4de;">,:</span>)<span style="color: #b0c4de;">;</span>ariwC(end<span style="color: #b0c4de;">,:</span>)]<span style="color: #b0c4de;">;</span>
<span class="linenr">103: </span><span style="color: #00ffff;">end</span>
<span class="linenr">104: </span>
</pre>
</div></li>
</ul>


</details>

<details class="code-details"
                 style ="padding: 1em;
                          background-color: #c9c9c9;
                          /* background-color: pink; */
                          border-radius: 15px;
                          color: hsl(157 75%);
                          font-size: 0.9em;
                          box-shadow: 0.05em 0.1em 5px 0.01em  #00000057;">
                  <summary>
                    <strong>
                      <font face="Courier" size="3" color="black">
                         Postprocessing
                      </font>
                    </strong>
                  </summary>
<p>
The <code>WVEVALWCOFS</code> routine is provided to help with postprocessing the results. The function uses the complex wave coefficients <code>ac</code> and evaluates the solution at <code>Nx</code> points in each piece of the model. 
</p>
<details class="code-details"
                 style ="padding: 1em;
                          background-color: white;
                          /* background-color: pink; */
                          border-radius: 15px;
                          color: hsl(157 75%);
                          font-size: 0.9em;
                          box-shadow: 0.05em 0.1em 5px 0.01em  #00000057;">
                  <summary>
                    <strong>
                      <font face="Courier" size="3" color="#2980b9">
                         The WVEVAlWCOFS function
                      </font>
                    </strong>
                  </summary>
<div class="org-src-container">
<pre class="src src-octave"><span style="color: #00ffff;">function</span> [Us<span style="color: #b0c4de;">,</span> Xs] <span style="color: #b0c4de;">=</span> <span style="color: #87cefa;">WVEVALWCOFS</span>(ac<span style="color: #b0c4de;">,</span> w<span style="color: #b0c4de;">,</span> h<span style="color: #b0c4de;">,</span> dL<span style="color: #b0c4de;">,</span> Nx<span style="color: #b0c4de;">,</span> pcs<span style="color: #b0c4de;">,</span> Klib)
<span style="color: #ff4500;">%</span><span style="color: #ff4500;">WVEVALWCOFS This is a routine for evaluating the wave coefficients at</span>
<span style="color: #ff4500;">%</span><span style="color: #ff4500;">arbitrary points on the model. </span>
<span style="color: #ff4500;">%</span>
<span style="color: #ff4500;">%   </span><span style="color: #ff4500;">USAGE:</span>
<span style="color: #ff4500;">%       </span><span style="color: #ff4500;">[Us, Xs] = WVEVALWCOFS(ac, w, h, dL, Nx, pcs, Klib);</span>
<span style="color: #ff4500;">%   </span><span style="color: #ff4500;">INPUTS:</span>
<span style="color: #ff4500;">%       </span><span style="color: #ff4500;">ac       : (Npts*Nwc, Nh) vector of complex wave coefficients</span>
<span style="color: #ff4500;">%       </span><span style="color: #ff4500;">w        : (1,1) frequency</span>
<span style="color: #ff4500;">%       </span><span style="color: #ff4500;">h        : (Nh,1) list of harmonics</span>
<span style="color: #ff4500;">%       </span><span style="color: #ff4500;">dL       : (1,Nwc) component summing vector</span>
<span style="color: #ff4500;">%       </span><span style="color: #ff4500;">Nx       : (1,1) Number of points per piece</span>
<span style="color: #ff4500;">%       </span><span style="color: #ff4500;">pcs      : Pieces structure</span>
<span style="color: #ff4500;">%       </span><span style="color: #ff4500;">Klib     : K library structure</span>
<span style="color: #ff4500;">%   </span><span style="color: #ff4500;">OUTPUTS:</span>
<span style="color: #ff4500;">%       </span><span style="color: #ff4500;">Us       : (Npcs, 1) cell, each with (Nx, Nh) wave coefficients</span>
<span style="color: #ff4500;">%       </span><span style="color: #ff4500;">Xs       : (Npcs, 1) cell, each with (Nx, 3) coordinate points    </span>

    Nh <span style="color: #b0c4de;">=</span> length(h)<span style="color: #b0c4de;">;</span>

    Xs <span style="color: #b0c4de;">=</span> arrayfun(@(pc) cell2mat(arrayfun(@(i) linspace(pc.coords(1<span style="color: #b0c4de;">,</span>i)<span style="color: #b0c4de;">,</span> pc.coords(end<span style="color: #b0c4de;">,</span>i)<span style="color: #b0c4de;">,</span> Nx)<span style="color: #b0c4de;">',</span> 1<span style="color: #b0c4de;">:</span>3<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'UniformOutput'</span><span style="color: #b0c4de;">,</span> false))<span style="color: #b0c4de;">,</span> pcs<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'UniformOutput'</span><span style="color: #b0c4de;">,</span> false)<span style="color: #b0c4de;">;</span>
    Us <span style="color: #b0c4de;">=</span> arrayfun(@(pc) zeros(Nx<span style="color: #b0c4de;">,</span>Nh)<span style="color: #b0c4de;">,</span> pcs<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'UniformOutput'</span><span style="color: #b0c4de;">,</span> false)<span style="color: #b0c4de;">;</span>

    <span style="color: #00ffff;">for</span> hi<span style="color: #b0c4de;">=</span>1<span style="color: #b0c4de;">:</span>Nh
        <span style="color: #00ffff;">for</span> n<span style="color: #b0c4de;">=</span>1<span style="color: #b0c4de;">:</span>length(pcs)
            Ks <span style="color: #b0c4de;">=</span> pcs(n).wcomps(<span style="color: #b0c4de;">:,</span>1)<span style="color: #b0c4de;">.*</span>cellfun(@(c) c(h(hi)<span style="color: #b0c4de;">*</span>w<span style="color: #b0c4de;">,</span>0)<span style="color: #b0c4de;">,</span> {Klib(pcs(n).wcomps(<span style="color: #b0c4de;">:,</span>2)).K}<span style="color: #b0c4de;">.'</span>)<span style="color: #b0c4de;">;</span>

            x1 <span style="color: #b0c4de;">=</span> (Xs{n}<span style="color: #b0c4de;">-</span>pcs(n).coords(1<span style="color: #b0c4de;">,:</span>))<span style="color: #b0c4de;">*</span>pcs(n).V<span style="color: #b0c4de;">/</span>pcs(n).S<span style="color: #b0c4de;">;</span>  <span style="color: #ff4500;">% Ordered 1D version of pts</span>
            <span style="color: #00ffff;">for</span> i<span style="color: #b0c4de;">=</span>1<span style="color: #b0c4de;">:</span>pcs(n).N<span style="color: #b0c4de;">-</span>1
                inds <span style="color: #b0c4de;">=</span> find(pcs(n).U(i)<span style="color: #b0c4de;">-</span>x1<span style="color: #b0c4de;">&lt;=</span>eps <span style="color: #b0c4de;">&amp;</span> x1<span style="color: #b0c4de;">-</span>pcs(n).U(i<span style="color: #b0c4de;">+</span>1)<span style="color: #b0c4de;">&lt;=</span>eps)<span style="color: #b0c4de;">;</span>

                k <span style="color: #b0c4de;">=</span> pcs(n).irange(1)<span style="color: #b0c4de;">-</span>1<span style="color: #b0c4de;">+</span>i<span style="color: #b0c4de;">;</span>
                Us{n}(inds<span style="color: #b0c4de;">,</span>hi) <span style="color: #b0c4de;">=</span> dL<span style="color: #b0c4de;">*</span>(ac((k<span style="color: #b0c4de;">-</span>1)<span style="color: #b0c4de;">*</span>4<span style="color: #b0c4de;">+</span>(1<span style="color: #b0c4de;">:</span>4)<span style="color: #b0c4de;">,</span>hi)<span style="color: #b0c4de;">.*</span>exp(Ks<span style="color: #b0c4de;">.*</span>((x1(inds)<span style="color: #b0c4de;">-</span>pcs(n).U(i))<span style="color: #b0c4de;">*</span>pcs(n).S)<span style="color: #b0c4de;">'</span>))<span style="color: #b0c4de;">;</span>
            <span style="color: #00ffff;">end</span>
        <span style="color: #00ffff;">end</span>
    <span style="color: #00ffff;">end</span>
<span style="color: #00ffff;">end</span>
</pre>
</div>


</details>

<p>
The deflection shapes of the harmonic corresponding to column <code>hi</code> of the output <code>Us</code> can be plotted by
</p>
<div class="org-src-container">
<pre class="src src-octave"><span style="color: #00ffff;">for</span> n<span style="color: #b0c4de;">=</span>1<span style="color: #b0c4de;">:</span>length(pcs)
  plot(Xs{n}(<span style="color: #b0c4de;">:,</span>1)<span style="color: #b0c4de;">,</span> Xs{n}(<span style="color: #b0c4de;">:,</span>2)<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'k-'</span>)<span style="color: #b0c4de;">;</span> hold on  <span style="color: #ff4500;">% Undeformed</span>

  plot(Xs{n}(<span style="color: #b0c4de;">:,</span>1)<span style="color: #b0c4de;">,</span> Xs{n}(<span style="color: #b0c4de;">:,</span>2)<span style="color: #b0c4de;">+</span>real(Us{n}(<span style="color: #b0c4de;">:,</span>hi))<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'.-'</span><span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'Color'</span><span style="color: #b0c4de;">,</span> colos(n<span style="color: #b0c4de;">,:</span>))<span style="color: #b0c4de;">;</span>  <span style="color: #ff4500;">% real part</span>
  plot(Xs{n}(<span style="color: #b0c4de;">:,</span>1)<span style="color: #b0c4de;">,</span> Xs{n}(<span style="color: #b0c4de;">:,</span>2)<span style="color: #b0c4de;">+</span>imag(Us{n}(<span style="color: #b0c4de;">:,</span>hi))<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'.--'</span><span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'Color'</span><span style="color: #b0c4de;">,</span> colos(n<span style="color: #b0c4de;">,:</span>))<span style="color: #b0c4de;">;</span> <span style="color: #ff4500;">% imag part</span>

  <span style="color: #ff4500;">% Also plot the deformations at the model points</span>
  achi <span style="color: #b0c4de;">=</span> ac(<span style="color: #b0c4de;">:,</span> hi)<span style="color: #b0c4de;">;</span>
  Up <span style="color: #b0c4de;">=</span> sum(achi(((pcs(n).irange(1)<span style="color: #b0c4de;">:</span>pcs(n).irange(2))<span style="color: #b0c4de;">'-</span>1)<span style="color: #b0c4de;">*</span>4<span style="color: #b0c4de;">+</span>(1<span style="color: #b0c4de;">:</span>4))<span style="color: #b0c4de;">,</span> 2)<span style="color: #b0c4de;">*</span>exp(<span style="color: #b0c4de;">-</span>1j<span style="color: #b0c4de;">*</span>angle(uall(mi)))<span style="color: #b0c4de;">;</span>
  plot(pcs(n).coords(<span style="color: #b0c4de;">:,</span>1)<span style="color: #b0c4de;">,</span> pcs(n).coords(<span style="color: #b0c4de;">:,</span>2)<span style="color: #b0c4de;">+</span>imag(Up)<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'ro'</span><span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'MarkerFaceColor'</span><span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'w'</span>)
  plot(pcs(n).coords(<span style="color: #b0c4de;">:,</span>1)<span style="color: #b0c4de;">,</span> pcs(n).coords(<span style="color: #b0c4de;">:,</span>2)<span style="color: #b0c4de;">+</span>real(Up)<span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'ko'</span><span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'MarkerFaceColor'</span><span style="color: #b0c4de;">,</span> <span style="color: #ffa07a;">'r'</span>)
<span style="color: #00ffff;">end</span>
</pre>
</div>


</details>
<p>
It is recommended to try running <a href="https://github.com/Nidish96/wavevib/tree/master/EXAMPLES/e_nlimpactclbeams.m">the code</a> by modifying some of the parameters above after going through this. It must be noted that the continuation parameters may need to be tuned when some parameters such as excitation or frequencies, damping, etc. are changed. 
</p>
</div>
</div>
<div id="outline-container-orgb32f8c6" class="outline-4">
<h4 id="orgb32f8c6"><span class="section-number-4">3.5.2.</span> Results</h4>
<div class="outline-text-4" id="text-3-5-2">
<p>
Fig. <a href="#orga67a771">7</a> plots the forced response results of this system (first harmonic) computed at three difference excitation amplitude levels. The expected behavior  corresponding to impact (linear until the gap is reached, followed by stiffening behavior) is observed. The tip displacement of the primary beam is plotted in the figures.
</p>

<div id="orga67a771" class="figure">
<p><img src="./FIGS/E_out.png" alt="E_out.png" width="600px" />
</p>
<p><span class="figure-number">Figure 7: </span>Forced Response Results for the Impacting Cantilever Beam Example</p>
</div>

<p>
Fig. <a href="#orgfca1d97">8</a> below plots the same along with the deflection shape corresponding to the first harmonic. A slider is implemented in <a href="https://github.com/Nidish96/wavevib/tree/master/EXAMPLES/e_nlimpactclbeams.m">the matlab script</a> that allows one to observe the deflection shape at different points along the forced response. So it is recommended to try running the code and moving the slider around a little bit. 
</p>

<div id="orgfca1d97" class="figure">
<p><img src="./FIGS/E_outshape.png" alt="E_outshape.png" width="600px" />
</p>
<p><span class="figure-number">Figure 8: </span>Forced Response along with deflection shapes</p>
</div>

<p>
<b>Note</b>: All the code in <a href="https://github.com/Nidish96/wavevib/tree/master/EXAMPLES/e_nlimpactclbeams.m">the matlab script</a> from line 107 onwards are merely postprocessing, and the user may choose to do this their own way also.
</p>
</div>
</div>
</div>
</div>
<div id="outline-container-org0a13756" class="outline-2">
<h2 id="org0a13756"><span class="section-number-2">4.</span> Development Avenues</h2>
<div class="outline-text-2" id="text-4">
</div>
<div id="outline-container-org287b7a3" class="outline-3">
<h3 id="org287b7a3"><span class="section-number-3">4.1.</span> <span class="todo TODO">TODO</span> Desirable Features</h3>
<div class="outline-text-3" id="text-4-1">
<ol class="org-ol">
<li class="off"><code>[&#xa0;]</code> 3D frame joint constitutions</li>
<li class="off"><code>[&#xa0;]</code> EPMC Implementation</li>
<li class="on"><code>[X]</code> Joints connecting multiple pieces</li>
<li class="off"><code>[&#xa0;]</code> More detailed examples</li>
<li class="off"><code>[&#xa0;]</code> Stability Implementation</li>
<li class="on"><code>[X]</code> Quasi-Periodic Calculations</li>
</ol>
</div>
</div>
<div id="outline-container-orgeb580e5" class="outline-3">
<h3 id="orgeb580e5"><span class="section-number-3">4.2.</span> <span class="todo TODO">TODO</span> Bugfixes</h3>
<div class="outline-text-3" id="text-4-2">
<ol class="org-ol">
<li>Multiharmonic excitation at single point has to be implemented</li>
<li>Allow for simple handling of constant coefficient matrices (not functions of @(w,xi)).</li>
<li>Find a way to properly handle the zero harmonics of boundary conditions.</li>
<li>Fix the reduced representations (WVAMATr, WVHBRESFUNr)</li>
</ol>
</div>
</div>
</div>
<div id="outline-container-org0f2ced9" class="outline-2">
<h2 id="org0f2ced9"><span class="section-number-2">5.</span> References</h2>
<div class="outline-text-2" id="text-5">
<style>.csl-left-margin{float: left; padding-right: 0em;}
 .csl-right-inline{margin: 0 0 0 1em;}</style><div class="csl-bib-body">
  <div class="csl-entry"><a id="citeproc_bib_item_1"></a>
    <div class="csl-left-margin">[1]</div><div class="csl-right-inline">N. N. Balaji, M. R. W. Brake, and M. J. Leamy, Wave-based analysis of jointed elastic bars: Nonlinear periodic response, <i>Nonlinear dynamics</i>, vol. 110, no. 3, pp. 20052031, Nov. 2022, doi: <a href="https://doi.org/10.1007/s11071-022-07765-0">10.1007/s11071-022-07765-0</a>.</div>
  </div>
  <div class="csl-entry"><a id="citeproc_bib_item_2"></a>
    <div class="csl-left-margin">[2]</div><div class="csl-right-inline">N. N. Balaji, M. R. W. Brake, and M. J. Leamy, Wave-based analysis of jointed elastic bars: Stability of nonlinear solutions, <i>Nonlinear dynamics</i>, vol. 111, no. 3, pp. 19711986, Feb. 2023, doi: <a href="https://doi.org/10.1007/s11071-022-07969-4">10.1007/s11071-022-07969-4</a>.</div>
  </div>
  <div class="csl-entry"><a id="citeproc_bib_item_3"></a>
    <div class="csl-left-margin">[3]</div><div class="csl-right-inline">K. F. Graff, <i>Wave Motion in Elastic Solids</i>. Courier Corporation, 2012.</div>
  </div>
  <div class="csl-entry"><a id="citeproc_bib_item_4"></a>
    <div class="csl-left-margin">[4]</div><div class="csl-right-inline">I. R. Praveen Krishna and C. Padmanabhan, Experimental and numerical investigations of impacting cantilever beams part 1: First mode response, <i>Nonlinear dynamics</i>, vol. 67, no. 3, pp. 19852000, Feb. 2012, doi: <a href="https://doi.org/10.1007/s11071-011-0123-2">10.1007/s11071-011-0123-2</a>.</div>
  </div>
  <div class="csl-entry"><a id="citeproc_bib_item_5"></a>
    <div class="csl-left-margin">[5]</div><div class="csl-right-inline">E. Emaci, T. A. Nayfeh, and A. F. Vakakis, Numerical and Experimental Study of Nonlinear Localization in a Flexible Structure with Vibro-Impacts, <i>Zamm - journal of applied mathematics and mechanics / zeitschrift fr angewandte mathematik und mechanik</i>, vol. 77, no. 7, pp. 527541, 1997, doi: <a href="https://doi.org/10.1002/zamm.19970770712">10.1002/zamm.19970770712</a>.</div>
  </div>
</div>

<p>
This website was generated using org-mode on emacs with the Bigblow html theme from <a href="https://github.com/fniessen/org-html-themes">https://github.com/fniessen/org-html-themes</a>.
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Nidish Narayanaa Balaji</p>
<p class="date">Created: 2023-06-01 Thu 13:51</p>
<p class="validation"><a href="https://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>